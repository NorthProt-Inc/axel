{"ts":"0207T2100","from":"quality","type":"claim","task":"QA-001","note":"v2.0 plan internal consistency verification started"}
{"ts":"0207T2100","from":"quality","type":"claim","task":"QA-002","note":"claude_reports 23 issues mapping completeness verification started"}
{"ts":"0207T2130","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:576","desc":"IVFFlat lists parameter inconsistency: comment says 'lists = sqrt(N)*10' with N=1000 which gives ~316, but actual setting is lists=100","fix":"Either change formula comment to 'lists = sqrt(N)*3' or change lists value to 316. Research (RES-001) should validate optimal lists value for 1K-100K vectors."}
{"ts":"0207T2130","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:399-419","desc":"Zod MemoryConfigSchema missing decay parameters: accessStabilityK, relationResistanceK, channelDiversityK, recencyBoost, recencyAgeThreshold, recencyAccessThreshold are defined in DecayConfig interface (line 798-808) but absent from the Zod config schema","fix":"Add missing decay parameters to MemoryConfigSchema.decay or create a separate DecayConfigSchema that includes all 10 parameters"}
{"ts":"0207T2130","from":"quality","type":"issue","sev":"HIGH","ref":"docs/adr/","desc":"12 ADRs listed as 'confirmed' (ADR-001 through ADR-012) in Section 10 but no ADR files exist in docs/adr/ directory. CONSTITUTION Section 3 requires confirmed ADRs to be append-only documents.","fix":"Architecture Division should create individual ADR documents for all 12 confirmed decisions before plan finalization"}
{"ts":"0207T2131","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:709-763","desc":"Naming collision: Memory layers use 'Layer 0-5' internally while Turtle Stack uses 'Layer 0-10'. Stream Buffer is 'Memory Layer 0' but lives inside 'Turtle Stack Layer 3'. This could cause confusion in distributed agent implementation.","fix":"Rename Memory layers to 'M0-M5' (or 'MemLayer') to distinguish from Turtle Stack layers L0-L10"}
{"ts":"0207T2131","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:980-986,298-300","desc":"Embedding capability defined in two places: LlmProvider.embed() (line 984) and separate EmbeddingService interface (line 298-300). Unclear which is canonical for the DI container.","fix":"Remove embed() from LlmProvider interface. Embedding should be a separate service (EmbeddingService) since not all LLM providers offer embeddings. LlmProvider should focus on chat/completion only."}
{"ts":"0207T2131","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:847-894","desc":"Context Assembler is in packages/core/ but needs data from pgvector and PostgreSQL graph (I/O). Plan says 'core has no I/O' but doesn't explicitly state how Assembler gets data via DI injection.","fix":"Add a note in Section 3.3 that Context Assembler receives data through injected Repository interfaces (MemoryRepository, GraphRepository, SessionRepository), not direct DB access"}
{"ts":"0207T2131","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:790-823","desc":"channelMentions field ambiguity: DecayInput defines it as 'number' (line 791) meaning 'how many channels mentioned this memory', but memories table stores channel_mentions as JSONB (line 567: {\"discord\": 3, \"telegram\": 1}). Is the number the count of distinct channels (2) or sum of all mentions (4)?","fix":"Clarify in DecayInput comment: channelMentions should be the count of distinct channels (Object.keys(channel_mentions).length), not sum of values"}
{"ts":"0207T2132","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1759-1784","desc":"claude_reports #08 (research_server.py 856-line monolith) has no mapping in Appendix A module mapping table. Research/browse functionality is not addressed in Axel architecture.","fix":"Add research_server.py mapping to Appendix A. Likely maps to infra/mcp/tools/research.ts or a dedicated research service"}
{"ts":"0207T2132","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:69","desc":"claude_reports #13 (IoT device ID hardcoded in 5 files) not addressed in Axel architecture. Phase 3 mentions IoT Bridge but doesn't mention how device IDs will be managed.","fix":"Add IoT device registry to config schema (SecurityConfigSchema or new IotConfigSchema) with device discovery or config-based device list"}
{"ts":"0207T2132","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:75","desc":"claude_reports #21 (XML tag 3x hardcoding, 22/32 registered) not addressed. Axel channels use different message format but the underlying issue of scattered format constants is not resolved.","fix":"Add a note that Axel uses structured OutboundMessage interface (line 1278-1283) which eliminates XML tag hardcoding entirely, or map this to the channel adapter format conversion"}
{"ts":"0207T2132","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:1243","desc":"InboundHandler type referenced in AxelChannel.onMessage() but not defined in the plan","fix":"Add type definition: type InboundHandler = (msg: InboundMessage) => Promise<void>"}
{"ts":"0207T2133","from":"quality","type":"done","task":"QA-001","out":"docs/plan/axel-project-plan.md","note":"Found 3 HIGH issues (IVFFlat param, config schema gap, missing ADR files), 5 MEDIUM issues (naming collision, dual embedding, context assembler I/O, channelMentions ambiguity, missing module mappings), 1 LOW issue. Budget arithmetic and MISSION.md compliance passed."}
{"ts":"0207T2133","from":"quality","type":"done","task":"QA-002","out":"docs/plan/axel-project-plan.md","note":"20/23 claude_reports issues have explicit Axel mappings. 3 MEDIUM gaps: #08 (research_server mapping), #13 (IoT device ID management), #21 (XML tag issue). All CRITICAL and HIGH issues are properly addressed."}
{"ts":"0208T0030","from":"quality","type":"claim","task":"QA-003","note":"v2.0 plan feasibility review started — npm packages, version compat, performance claims, Redis drift"}
{"ts":"0208T0035","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:192-197,668-691,710-725,1206-1215","desc":"Redis usage violates 'PostgreSQL single DB' principle (MISSION.md #2). Session Router (line 677) stores active session state exclusively in Redis with no PG fallback — Redis restart breaks cross-channel continuity. Stream Buffer (Layer 0, line 710) is entirely Redis Streams with no PG backup. PubSub (line 678) has at-most-once delivery with no fallback. ADR-002 (single DB) and ADR-003 (Redis for working memory + pub/sub) are in unacknowledged tension.","fix":"1) Redefine ADR-002 as 'single source of truth' — PG is authoritative, Redis is ephemeral acceleration. 2) Add PG shadow table for Session Router active sessions with reconstruction path on Redis miss. 3) Specify Working Memory flush strategy (write-through frequency, error handling). 4) Document Stream Buffer as intentionally ephemeral with graceful degradation. 5) Replace PubSub with Redis Streams consumer groups (ack + replay) or add PG event log fallback. 6) Add 'Relationship to ADR-002' section in ADR-003."}
{"ts":"0208T0035","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:394,558,850","desc":"text-embedding-004 (768d) was deprecated January 2026. Plan references it at lines 394, 558 (vector(768)), and 850. Successor is gemini-embedding-001 (default 3072d, supports output_dimensionality=768 via MRL).","fix":"Update all references from text-embedding-004 to gemini-embedding-001. Decide on dimension: keep 768d (via output_dimensionality param) for migration ease, or upgrade to 3072d for quality. Update pgvector column definition and IVFFlat parameters accordingly."}
{"ts":"0208T0035","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:850-851","desc":"Plan claims 'tiktoken 기반 정확한 토큰 카운팅' (line 850) but tiktoken is for OpenAI tokenization (cl100k_base, o200k_base), NOT for Claude/Anthropic models. @anthropic-ai/tokenizer exists but is stale (v0.0.4, last updated July 2023).","fix":"Use @anthropic-ai/sdk count_tokens API endpoint for Claude models (server-side, always accurate). Use tiktoken for OpenAI/Gemini estimation only. Alternatively, use a per-model tokenizer strategy: { anthropic: sdk.count_tokens(), google: estimate via tiktoken, ollama: model-specific }."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:576","desc":"IVFFlat formula 'lists = sqrt(N)*10' is NOT from pgvector docs. Official recommendation: rows/1000 for <1M rows, sqrt(rows) for >1M. For N=1000, official formula gives lists=1 (index provides no benefit). For N=100K, official gives lists=100. With only 1000 vectors, IVFFlat is counterproductive — sequential scan or HNSW is better. This supersedes QA-001 finding on same line with corrected source.","fix":"1) Remove the 'sqrt(N)*10' formula comment entirely. 2) For <10K vectors: skip IVFFlat, use sequential scan. 3) For 10K-100K: use lists=rows/1000. 4) Consider HNSW as default index (pgvector docs increasingly recommend it). 5) RES-001 should validate with actual benchmarks."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1022-1029","desc":"Gemini Flash intent classification claim '<50ms' (line 1022) is not achievable via API. Gemini Flash TTFT is ~300ms minimum (API network RTT alone is 20-80ms). Sub-50ms requires a local model, not an external API call.","fix":"Either: 1) Revise latency target to '<500ms' for API-based classification, or 2) Use a local lightweight classifier (e.g., ONNX runtime with a small model) for the <50ms target, with Gemini Flash as fallback for ambiguous cases."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:380-475","desc":"Zod v4 (current latest: 4.3.6) has breaking API changes from v3. Plan's Zod schema examples may have been written against v3 API. Key changes: .transform(), .refine(), schema inference behavior.","fix":"Verify all Zod schema examples in Section 4 Layer 1 compile under Zod v4. Pin Zod version in package.json or update examples if needed."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:983","desc":"LlmProvider.embed() method (line 983) should be removed per QA-001 finding, but also: LlmProvider.countTokens() is model-specific and cannot be a simple synchronous function for all providers. Anthropic requires an API call (count_tokens endpoint), while tiktoken is synchronous. The interface conflates sync and async token counting.","fix":"Change countTokens to async: countTokens(text: string): Promise<number>. Or split into estimateTokens (sync, approximate) and countTokens (async, exact via API)."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1685-1686","desc":"'모든 응답의 첫 토큰이 500ms 이내' (line 1686) is achievable at p50 but not as a reliable guarantee. End-to-end pipeline: Redis (~1ms) + pgvector (~20ms) + context assembly (~5ms) + LLM TTFT (~300-800ms variable). Realistic: p50 ~400-500ms, p95 ~700-1000ms.","fix":"Revise success criterion to '첫 토큰 500ms p50, 1000ms p95' or specify that 500ms applies only to cached/simple responses. Aggressive caching of common intents can help meet tighter targets."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1697","desc":"Docker cold start '<30s' (line 1697) is realistic only with cached images. First deployment with image pulls + pgvector extension initialization will exceed 30s.","fix":"Add qualifier: '<30s with cached images'. First deployment target should be separate (e.g., <120s)."}
{"ts":"0208T0036","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:340","desc":"tsdown is from the Rolldown ecosystem (github.com/rolldown/tsdown), not 'OpenClaw'. The plan says 'OpenClaw 동일' for tsdown, but this refers to the build tool choice, not the source. Minor reference accuracy issue.","fix":"Clarify: 'OpenClaw uses tsdown (Rolldown ecosystem)' — the reference is to tool choice alignment, not origin."}
{"ts":"0208T0037","from":"quality","type":"done","task":"QA-003","out":"docs/plan/axel-project-plan.md","note":"Feasibility review complete. Found 5 HIGH issues (Redis single-DB drift, deprecated embedding model, tiktoken wrong for Claude, IVFFlat formula correction, Gemini Flash latency claim), 4 MEDIUM issues (Zod v4 compat, countTokens sync/async, TTFT target, Docker cold start qualifier), 1 LOW (tsdown attribution). All npm packages verified to exist and be maintained. Node.js 22 compatibility confirmed for all."}
{"ts":"0208T0100","from":"quality","type":"claim","task":"QA-004","note":"v2.0 plan cross-reference integrity verification — ADR refs, package paths, interface xrefs, type ownership, migration direction"}
{"ts":"0208T0105","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:993,1054-1061","desc":"ToolDefinition type is used in ChatParams (line 993, packages/infra/src/llm/types.ts) but defined in MCP registry (line 1054, packages/infra/src/mcp/registry.ts). This creates an intra-package dependency where the LLM module depends on the MCP module, violating the expected direction (MCP depends on LLM, not vice versa). For distributed agent implementation, the type's canonical home is unclear.","fix":"Extract ToolDefinition to packages/core/src/types/ as a shared type. Both infra/llm and infra/mcp should import from core/types. This aligns with the plan's principle that core has no I/O — pure type definitions belong in core."}
{"ts":"0208T0105","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1427","desc":"Section 5.2 migration direction is REVERSED. Line 1427 says 'Gemini embedding-001 → text-embedding-004 (더 높은 품질)' suggesting migrating FROM embedding-001 TO text-embedding-004. But text-embedding-004 is the OLDER deprecated model and gemini-embedding-001 is its NEWER successor. This contradicts QA-003 finding that text-embedding-004 was deprecated Jan 2026. Also contradicts Section 11 line 1734 which lists embedding-001 as the newer option.","fix":"Reverse the arrow: 'text-embedding-004 → gemini-embedding-001 (최신, 공식 권장)'. Or remove line 1427 entirely and defer to Section 11 undecided item."}
{"ts":"0208T0105","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:298,983","desc":"EmbeddingService.embed() signature (line 298) takes singular 'text: string' returning Float32Array. LlmProvider.embed() (line 983) takes plural 'texts: string[]' returning Float32Array[]. Even if LlmProvider.embed() is removed per QA-001 recommendation, EmbeddingService only has embed(singular) + embedBatch(plural) — no indication which the ContextAssembler should use. Batch is more efficient for semantic search of multiple memories.","fix":"Keep EmbeddingService with both signatures. Clarify in ContextAssembler section (line 854) that it uses embedBatch() for multi-memory embedding in semantic search. Remove embed() from LlmProvider entirely (already recommended in QA-001)."}
{"ts":"0208T0105","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:209-241,323-1365,709-763","desc":"Three overlapping 'Layer' numbering systems: (1) Package structure comments use L0-L4 for core, L5 for infra, L6 for channels, L7 for gateway (lines 209-241), (2) Turtle Stack uses Layer 0-10 (lines 323-1365), (3) Memory uses Layer 0-5 (lines 709-763). The package comments (L0-L7) don't match Turtle Stack numbering: packages/core is labeled 'L0-L4' but Turtle Stack Layers 0-4 cover Runtime/Config/Persistence/Memory/Identity, while core/ actually contains memory, persona, decay, context, orchestrator spanning Turtle Layers 3-7.","fix":"Remove L0-L7 labels from package structure comments (lines 209-241) as they create a false mapping to Turtle Stack layers. Instead use descriptive labels like 'core engine (pure logic)', 'infrastructure adapters (I/O boundary)', etc."}
{"ts":"0208T0106","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md","desc":"Token budget arithmetic and all declared file paths passed verification. Sum: 8K+2K+40K+12K+4K+4K+2K+4K=76K (correct). 200K-76K=124K generation budget (correct). All 11 TypeScript file paths in code examples match the monorepo structure declared in Section 3.3.","fix":"No fix needed — informational pass."}
{"ts":"0208T0106","from":"quality","type":"done","task":"QA-004","out":"docs/plan/axel-project-plan.md","note":"Cross-reference integrity review complete. Found 2 HIGH (ToolDefinition type ownership, migration direction reversed), 2 MEDIUM (EmbeddingService signature inconsistency, triple Layer numbering confusion), 1 LOW (informational pass on arithmetic + paths). 7 previously reported issues confirmed still unresolved (no arch/research output yet). File path consistency and token budget arithmetic passed all checks."}
{"ts":"0208T0200","from":"quality","type":"claim","task":"QA-005","note":"v2.0 plan security design review — auth model, input validation, secrets management, OWASP alignment, WebSocket security, migration script safety"}
{"ts":"0208T0210","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1286-1319,1353-1365","desc":"Gateway authentication model is underspecified. Layer 9 lists 'auth required' on 6 routes and Layer 10 says 'JWT + timing-safe comparison', but no JWT details are defined: no secret/key management (symmetric HMAC vs asymmetric RSA/ECDSA), no token expiry/refresh strategy, no token storage location (httpOnly cookie vs Authorization header), no JWKS endpoint or key rotation plan. For a single-user system, JWT may be over-engineered — a static bearer token with timing-safe comparison (as in OpenClaw pattern, line 124) would be simpler and equally secure.","fix":"1) Add JWT spec to SecurityConfigSchema: algorithm (HS256 or ES256), secret source (env var), expiry (e.g., 24h), refresh strategy. 2) Or simplify to static bearer token for MVP (single-user): generate once, store in .env, compare with crypto.timingSafeEqual(). 3) Either way, specify token transport: Authorization: Bearer header for API, WS upgrade query param or first-message auth. 4) This should be an ADR decision (ADR-XXX: Authentication Strategy)."}
{"ts":"0208T0210","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1314","desc":"WebSocket endpoint 'WS /ws' has no authentication or authorization specification. HTTP routes clearly mark 'auth required' but WebSocket has no equivalent. An unauthenticated WebSocket allows anyone to connect and stream real-time data, potentially including conversation content and memory search results. This is especially critical since WebSocket upgrade happens via HTTP GET which may bypass POST-based auth middleware.","fix":"Specify WS auth strategy: 1) Token in WS upgrade request query param (?token=xxx) validated during upgrade handshake, or 2) First message must be auth message with valid token, connection closed if not received within N seconds. 3) Add per-message rate limiting on WS. 4) Add to security test cases in Section 6.4."}
{"ts":"0208T0210","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1100-1101,1082-1084","desc":"Command execution tool validates command name against allowlist (line 1107) but does NOT validate the 'args' array or 'cwd' path. An attacker (or prompt injection) could pass malicious arguments: e.g., command='git' args=['push', '--force', 'origin', 'main'] or command='find' args=['/', '-exec', 'rm', '-rf', '{}', ';']. Similarly, cwd is an optional string with no path validation — could be set to sensitive directories. The readFileTool validates path via validatePath() (line 1084) but executeCommandTool does not validate cwd.","fix":"1) Add argument validation per command: define allowed argument patterns for each allowlisted command (e.g., 'git' allows ['status','log','diff','show'] but not ['push --force','reset --hard']). 2) Validate cwd with same validatePath() used in readFileTool. 3) Consider a structured allowlist: Map<command, {allowedSubcommands: string[], blockedFlags: string[], cwdRestriction: string}>. 4) Add integration test: 'command injection via args is blocked'."}
{"ts":"0208T0211","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:440-449","desc":"SecurityConfigSchema is minimal — missing several security-critical configuration fields that are implied by the architecture but not configurable. Missing: (1) JWT secret/key configuration, (2) CORS allowed origins list, (3) HTTPS/TLS configuration or enforcement flag, (4) session timeout duration, (5) max request body size, (6) webhook signature verification secrets (Discord/Telegram verify incoming webhooks via signatures). Rate limit config exists (maxRequestsPerMinute) but is global — no per-endpoint or per-user granularity.","fix":"Extend SecurityConfigSchema with: jwtSecret: z.string().min(32), corsAllowedOrigins: z.array(z.string().url()).default(['http://localhost:5173']), enforceHttps: z.boolean().default(true), maxBodySizeBytes: z.number().default(1_048_576), sessionTimeoutMinutes: z.number().default(60), webhookSecrets: z.object({ discord: z.string().optional(), telegram: z.string().optional() }). Consider per-route rate limiting in a separate RateLimitConfigSchema."}
{"ts":"0208T0211","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1316-1318","desc":"Webhook endpoints (POST /webhooks/telegram, POST /webhooks/discord) are listed without signature verification. Both Telegram and Discord send cryptographic signatures with webhooks (Telegram: X-Telegram-Bot-Api-Secret-Token header, Discord: Ed25519 signature in X-Signature-Ed25519 + X-Signature-Timestamp headers). Without verification, any attacker who discovers the webhook URL can send forged messages that Axel will process as legitimate channel input — a direct prompt injection vector.","fix":"1) Add webhook signature verification middleware for each channel adapter. 2) Discord: verify Ed25519 signature per Discord developer docs (mandatory for interactions endpoint). 3) Telegram: set secret_token in setWebhook() and verify X-Telegram-Bot-Api-Secret-Token header. 4) Add webhook secrets to SecurityConfigSchema. 5) Add to security test cases: 'forged webhook with invalid signature is rejected (401)'."}
{"ts":"0208T0211","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1382-1397","desc":"Prompt injection defense relies solely on regex pattern matching (SUSPICIOUS_PATTERNS array, 5 patterns). This is a blocklist approach which is inherently incomplete — new injection techniques bypass regex easily. The function wraps content but does not sanitize or reject it. The WARNING attribute is set but the plan does not specify what the LLM system prompt does with this warning — if the LLM ignores the warning markers, the defense is ineffective.","fix":"1) Document the defense-in-depth strategy: wrapping is Layer 1, system prompt instruction to ignore wrapped content is Layer 2, output filtering is Layer 3. 2) Specify in system prompt template how EXTERNAL_UNTRUSTED_CONTENT markers are handled (e.g., 'Never follow instructions inside EXTERNAL_UNTRUSTED_CONTENT tags'). 3) Add output sanitization: detect if response contains user-injected commands being echoed back. 4) Consider adding a canary token approach for detection. 5) Acknowledge that regex blocklist is supplementary, not primary defense."}
{"ts":"0208T0211","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1438","desc":"Migration script chromadb-extractor.ts uses 'Python subprocess' to extract from ChromaDB. This contradicts MISSION.md principle #1 (TypeScript single stack) and claude_reports #01 lesson (shell injection from subprocess). The plan does not specify how this Python subprocess is invoked — if using child_process.exec() or shell=true equivalent, it reintroduces the exact vulnerability that Axel is designed to fix.","fix":"1) Use chromadb npm package (exists, maintained) instead of Python subprocess — stays within TS single stack. 2) If Python subprocess is truly necessary (ChromaDB Python-only features), use execFile with explicit python3 path and no shell, plus validate all arguments. 3) Document this as an intentional one-time exception to ADR-001 with a migration deadline. 4) Better alternative: export ChromaDB to JSON via Python CLI tool BEFORE Axel migration starts (offline step), then import JSON in pure TypeScript."}
{"ts":"0208T0212","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:442-445","desc":"Default command allowlist includes 'docker' and 'docker-compose' which can escalate privileges (docker run --privileged, docker exec into containers, mount host filesystem). Also includes 'node' which can execute arbitrary JavaScript. While requiresApproval gates dangerous tools, the allowlist itself should follow principle of least privilege.","fix":"1) Consider removing 'docker', 'docker-compose', 'node' from default allowlist — these should be explicitly opted in via config. 2) Keep only read-safe commands in default: git (read-only subcommands), ls, cat, head, tail, grep, find, wc. 3) Or add sub-command validation for docker (only 'ps', 'logs', 'stats' by default)."}
{"ts":"0208T0212","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:455,461-463","desc":"Database URL (config.db.url) and Redis URL (config.redis.url) use z.string().url() validation. Connection strings like 'postgresql://user:password@host:5432/db' and 'redis://host:6379' contain credentials in the URL. The plan does not mention redacting these from logs or error messages. interaction_logs table (line 661) stores error TEXT which could contain connection strings if a DB connection error occurs.","fix":"1) Add a note in error-handler.ts spec to redact connection strings from error messages before logging. 2) Consider separate config fields: db.host, db.port, db.user, db.password, db.database instead of a single URL — this avoids credentials in URL format. 3) Ensure interaction_logs.error column does not store raw exception messages containing connection strings."}
{"ts":"0208T0212","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:1536-1541","desc":"Security test cases (Section 6.4) cover 5 scenarios but miss several critical areas: (1) no JWT/auth token expiry test, (2) no WebSocket auth test, (3) no webhook signature verification test, (4) no SQL injection test (parameterized queries assumed but not tested), (5) no rate limiting effectiveness test, (6) no CORS preflight test.","fix":"Add to Section 6.4 Security test cases: [ ] JWT/bearer token expiry and refresh work correctly, [ ] WebSocket rejects unauthenticated connections, [ ] Webhook endpoints reject forged signatures, [ ] SQL injection via user input is prevented (parameterized queries), [ ] Rate limiter returns 429 after threshold, [ ] CORS preflight returns correct headers and rejects unauthorized origins."}
{"ts":"0208T0212","from":"quality","type":"done","task":"QA-005","out":"docs/plan/axel-project-plan.md","note":"Security design review complete. Found 3 HIGH issues (JWT/auth underspecified, WebSocket unauthenticated, command args unvalidated), 4 MEDIUM issues (SecurityConfig incomplete, webhook signatures missing, prompt injection defense shallow, migration subprocess risk), 3 LOW issues (docker in allowlist, credentials in URL, missing security tests). claude_reports #01 (shell injection) and #07 (path traversal) are well-addressed in tool system. OWASP alignment: A01 Broken Access Control (HIGH — auth gaps), A03 Injection (partially addressed — command args gap), A04 Insecure Design (MEDIUM — prompt injection defense incomplete), A07 Security Misconfiguration (MEDIUM — incomplete security config schema)."}
{"ts":"0208T0300","from":"quality","type":"claim","task":"QA-006","note":"v2.0 plan implementability review — DI graph completeness, error handling gaps, state machine/lifecycle completeness, streaming pipeline"}
{"ts":"0208T0310","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:291-311","desc":"DI container covers only 2 of ~15 injectable services. Container example (lines 306-311) wires PgMemoryRepository and GeminiEmbeddingService only. Missing: PersonaEngine, LlmProvider (×3 adapters), SessionRouter, AxelChannel (×4 adapters), ContextAssembler, ModelRouter, CircuitBreaker, RetryHandler, ToolRegistry. 4 of 7 service interfaces (PersonaEngine, LlmProvider, SessionRouter, AxelChannel) have no implementation class named. A distributed agent cannot implement the bootstrap code (apps/axel/src/main.ts) without knowing what classes to instantiate.","fix":"1) Add a complete DI container specification showing all ~15 services and their wiring order. 2) Name all implementation classes: AnthropicLlmProvider, GoogleLlmProvider, OllamaLlmProvider, RedisSessionRouter, DiscordChannel, TelegramChannel, CliChannel, WebChatChannel, FilePersonaEngine. 3) Show the full dependency graph with construction order. This could be a section in the plan or part of ADR-006 (Constructor Injection)."}
{"ts":"0208T0310","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:291-294,989,1149,311","desc":"Core domain types Memory, Message, MemoryEngine are used in interfaces but never defined. Memory is the fundamental data type (MemoryRepository.store(memory: Memory), line 292). Message is used in ChatParams.messages (line 989) and reactLoop params (line 1144) but is distinct from InboundMessage. MemoryEngine is instantiated (line 311) but has no class or interface definition. A distributed agent cannot implement any of these services without knowing the shape of these types.","fix":"1) Define Memory interface in core/types (fields: uuid, content, memoryType, importance, embedding, createdAt, lastAccessed, accessCount, sourceChannel, channelMentions, decayedImportance — matching the memories DB table). 2) Define Message interface (role, content, timestamp, metadata — the internal orchestrator format). 3) Define MemoryEngine class with its public methods and constructor dependencies. 4) Also define ToolResult, ReActEvent, SessionSummary, HealthStatus."}
{"ts":"0208T0310","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:1142-1176","desc":"ReAct loop (central orchestration mechanism) has zero error handling. No try/catch around llmProvider.chat() or executeTool(). ChatChunk.type==='error' (defined at line 999) is never handled in the loop. totalTimeoutMs (line 1138) is defined in config but never enforced — no AbortController or deadline check. When executeTool() fails, the error is not propagated back to the LLM for re-planning. When maxIterations is reached, there is no user-facing warning or partial result summary.","fix":"1) Wrap llmProvider.chat() in try/catch with fallback to next provider per fallbackChain. 2) Handle chunk.type==='error' by yielding an error event and deciding retry vs abort. 3) Implement totalTimeoutMs via AbortController or Promise.race. 4) On tool failure, push tool_result with error content to messages so LLM can re-plan. 5) On maxIterations exit, yield a warning event with summary of completed tool calls."}
{"ts":"0208T0311","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md","desc":"No error type hierarchy exists. The plan mentions ToolError (line 1108), HttpError (line 1326), FailoverError (line 126), classifyError() (line 1327), retryableErrors strings (line 1015) — but none are defined as classes, none share a base type, and the classification logic is unspecified. The mapping from raw API errors to categories (rate_limit, server_error, timeout) is undefined. Without this, each implementing agent will create incompatible error types.","fix":"1) Define base AxelError class extending Error (fields: code, category, retryable, publicMessage). 2) Define subclasses: TransientError (retryable), PermanentError, ValidationError, AuthError, ProviderError, ToolError. 3) Define error category enum matching retryableErrors/cooldowns keys. 4) Specify classifyError() mapping: HTTP 429 → rate_limit, HTTP 5xx → server_error, ETIMEDOUT → timeout, etc. 5) This should be an ADR (ADR-016: Error Taxonomy)."}
{"ts":"0208T0311","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:668-691","desc":"Redis serves 5 critical functions (working memory, session routing, rate limiting, intent cache, speculative prefetch) with zero error handling specification. No fallback when Redis is unavailable. No reconnection strategy. No specification of what happens to in-flight requests during Redis downtime. This compounds QA-003's Redis drift finding — Redis is both a primary store AND has no failure mode spec.","fix":"1) Define Redis failure modes and responses: connection lost → reconnect with backoff, command timeout → retry once then degrade. 2) For each Redis function, define degradation path: working memory → fall back to PG query, session routing → fall back to PG session table lookup, rate limiting → allow (fail-open) or block (fail-closed), intent cache → skip cache and classify directly, prefetch → skip. 3) Add a Redis circuit breaker config."}
{"ts":"0208T0311","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:709-763","desc":"Memory consolidation (L2 Episodic → L3 Semantic) is the core long-term memory formation mechanism but is entirely unspecified. consolidationIntervalHours=6 config exists (line 423) but no algorithm: what LLM prompt extracts memories from conversations? How are duplicates detected? How are importance scores initially assigned? How is the extraction triggered (cron? event?)? Similarly, L0→L1 promotion (Stream Buffer → Working Memory) has no defined rules for which events become working memory entries.","fix":"1) Define consolidation algorithm: a) select sessions ended since last consolidation, b) send session transcript to LLM with extraction prompt, c) for each extracted fact/preference/insight, generate embedding, d) check for duplicates via cosine similarity > 0.95, e) assign initial importance by memory type. 2) Define L0→L1 rules: typing events update working memory metadata only, IoT events create system messages in working memory, channel switch events trigger session resolution. 3) Define Progressive Compression: when turns > 20, summarize oldest 10 turns into 1 compressed entry."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:255","desc":"Graceful shutdown sequence is completely unspecified. lifecycle.ts is listed in project structure (line 255) but its behavior is undefined. No SIGTERM/SIGINT handling. No shutdown ordering (stop channels → drain requests → flush Redis to PG → close connections). No Redis-to-PG flush on shutdown — if process dies, all active working memory context is lost (Redis EXPIRE will clean up but data never reaches PG). Docker default SIGTERM grace period is 10s, while totalTimeoutMs is 300s — guaranteed data loss for in-flight requests.","fix":"1) Define shutdown sequence: a) SIGTERM handler sets isShuttingDown=true, b) stop accepting new messages on all channels, c) /health returns 503, d) wait for in-flight ReAct loops (with reduced timeout), e) flush all Redis working memory to PG sessions, f) stop Redis PubSub, g) close Redis connection, h) close PG pool. 2) Set Docker stop_grace_period to 30s. 3) Implement write-through for working memory (write to PG on every turn, not just on flush) as a safety net."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:510-528,671-691,1184-1202","desc":"Session lifecycle has no explicit state machine. No SessionState enum (created/active/idle/ended/archived). The idle-to-ended transition is undefined — Redis EXPIRE fires after 1 hour inactivity (line 674) but no handler subscribes to keyspace notifications to trigger endSession(). Without this, sessions remain open in PostgreSQL indefinitely (ended_at stays NULL). No archival mechanism for the 30-day sessionArchiveDays config (line 422). No concurrent session policy — simultaneous messages from Discord and Telegram could race on resolveSession().","fix":"1) Add SessionState enum and status column to sessions table. 2) Define idle detection: either Redis keyspace notifications (__keyevent@0__:expired) or a periodic cleanup job (every 5 min, find sessions with lastActivityAt > 1h ago). 3) On idle-to-ended: call endSession() to generate summary and move to episodic memory. 4) Define archival: after 30 days, sessions are soft-deleted or moved to archive partition. 5) Define concurrency: resolveSession() uses Redis SETNX or PG advisory lock to prevent race conditions."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1235-1284","desc":"AxelChannel interface lacks reconnection lifecycle. Only start() and stop() are defined — no reconnect(), no onDisconnect event, no reconnection backoff strategy. Discord and Telegram both experience frequent connection drops, rate limits, and session invalidation. HealthStatus type is used (line 1242) but never defined. No per-channel circuit breaker (Circuit Breaker is LLM-only at line 1005). No specification for partial startup failure (what if Discord fails but Telegram connects — continue or abort?).","fix":"1) Add reconnection to AxelChannel: onDisconnect?(handler): void, reconnect?(): Promise<void>. 2) Define HealthStatus type: {status: 'healthy'|'degraded'|'disconnected', latencyMs?: number, lastError?: string}. 3) Specify startup policy: channels start independently, partial failure logs warning but does not abort system. 4) Add per-channel circuit breaker config for API rate limits."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1004-1008,1032","desc":"Circuit Breaker has config values but no state machine. Classic three states (closed/open/half-open) are not defined. failureThreshold (line 1006) presumably triggers closed→open, but half-open→closed transition (success threshold, probe count) is unspecified. No integration between circuit breaker and fallback chain (line 1032) — when Anthropic breaker opens, does system auto-switch to Google? Is this per-provider or global? Circuit breaker scoped only to LLM — no DB or Redis circuit breaking.","fix":"1) Define state machine: closed (normal) → open (after failureThreshold failures) → half-open (after cooldown expires, allow 1 probe) → closed (on probe success) / open (on probe failure). 2) Make circuit breaker per-provider with shared state. 3) Connect to fallback chain: when provider's breaker is open, skip to next in chain. 4) Consider DB and Redis circuit breakers for completeness."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1249-1250,999,1306,1314","desc":"Streaming pipeline has no error handling specification. First-class design goal ('Streaming-first response pipeline', line 971) but: no partial response recovery when LLM stream drops mid-response, no client disconnect detection (SSE heartbeat, WS ping/pong), no abort mechanism (AbortController) when client disconnects (LLM charges continue), no backpressure when channel adapter (e.g., Discord 5 edits/5s rate limit) cannot keep up with LLM stream, no streaming error event format (ChatChunk type='error' content is just a string, no structured error code).","fix":"1) Add AbortController to chat() call, abort on client disconnect. 2) Define partial response handling: on LLM stream drop, save partial content to messages, yield error event to client. 3) Add backpressure: buffer stream chunks and batch-send at channel's rate limit. 4) Define structured streaming error: {type: 'error', code: string, retryable: boolean, message: string}. 5) Add SSE heartbeat (every 15s) and WS ping/pong (every 30s) for connection liveness."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:938-944,470","desc":"PersonaEngine hot-reload has no in-flight request handling specification. If reload() is called during an active ReAct loop, the loop already has the old persona's system prompt. No atomic swap mechanism (read-copy-update vs mutation). No file-watch trigger defined (fs.watch? API call? webhook?). No error handling if new persona file is malformed — does system keep old persona or crash?","fix":"1) Use read-copy-update: load new persona into separate object, atomically swap reference. In-flight requests continue with old persona, new requests get new. 2) Trigger via fs.watch() on persona.path, debounced (500ms). 3) On malformed input: log error, keep old persona, do not crash. 4) Add PersonaEngine.onReload?(handler): void event for observability."}
{"ts":"0208T0312","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:619-628,757-762","desc":"Meta Memory (Layer 5) feedback loop to Layer 0 (Speculative Prefetch) is described conceptually but has no mechanism. L5 records access patterns and generates hot_memories materialized view. L0 says 'Speculative Prefetch trigger'. But what data flows from L5 to L0, when, and how? No query from L0 to L5. No pre-warming logic defined.","fix":"Define prefetch mechanism: when onTypingStart fires (L0 event), query hot_memories view for this user's most-accessed memories, pre-load their embeddings into Redis prefetch hash (axel:prefetch:{userId}). Context Assembler checks prefetch cache before doing full semantic search. Refresh strategy: invalidate prefetch on session end, refresh hot_memories view every consolidationIntervalHours."}
{"ts":"0208T0313","from":"quality","type":"done","task":"QA-006","out":"docs/plan/axel-project-plan.md","note":"Implementability review complete. Analyzed DI graph, error handling, and state/lifecycle completeness. Found 8 HIGH issues (incomplete DI container, undefined core types, ReAct loop no error handling, no error taxonomy, Redis failure modes undefined, memory consolidation unspecified, graceful shutdown missing, session state machine missing), 4 MEDIUM issues (channel reconnection, circuit breaker state machine, streaming errors, persona hot-reload), 1 LOW issue (meta memory feedback loop). Root cause pattern: plan thoroughly documents static structure (interfaces, schemas, storage) but dynamic behavior (state transitions, error flows, shutdown ordering) is largely unspecified. Recommend 2 new ADRs: ADR-016 (Error Taxonomy), ADR-017 (Resilience Patterns). CONSTITUTION quality gate 'Specs are concrete enough for distributed agent implementation' is NOT MET for error handling and lifecycle areas."}
{"ts":"0208T0400","from":"quality","type":"claim","task":"QA-007","note":"Comprehensive review summary — synthesizing QA-001 through QA-006 findings into prioritized action plan for Architecture Division"}
{"ts":"0208T0410","from":"quality","type":"issue","sev":"CRITICAL","ref":"CONSTITUTION:§3,MISSION.md:§3","desc":"QUALITY GATE ASSESSMENT — 6 reviews (QA-001 to QA-006) completed, 45 issues found (21 HIGH, 18 MEDIUM, 6 LOW). CONSTITUTION §3 Quality Gates status: (1) Consistency: NOT MET — 3 HIGH contradictions (Redis/PG principle, embedding migration direction, IVFFlat formula), 7 MEDIUM inconsistencies. (2) Completeness: PARTIAL — 20/23 claude_reports mapped, 3 MEDIUM gaps. (3) Traceability: PARTIAL — module mapping exists but 3 issues unmapped. (4) Feasibility: NOT MET — 3 HIGH factual errors (deprecated model, wrong tokenizer, impossible latency claim). (5) Sources: N/A (no research output yet). Plan CANNOT be finalized in current state. Minimum requirements for finalization: resolve all 21 HIGH issues and pass all 5 quality gates.","fix":"Coordinator should prioritize: Phase 1 (blocking) — resolve 21 HIGH issues via arch revisions + 2 new ADRs. Phase 2 (quality) — resolve 18 MEDIUM issues. Phase 3 (polish) — address 6 LOW issues at discretion."}
{"ts":"0208T0410","from":"quality","type":"issue","sev":"CRITICAL","ref":"docs/adr/","desc":"BLOCKER: 12 ADRs declared as 'confirmed' in plan Section 10 but ZERO ADR files exist in docs/adr/ (only .gitkeep). CONSTITUTION §1 assigns docs/adr/ to Architecture Division. CONSTITUTION §3 says confirmed ADRs must exist as append-only documents. This is the single largest gap — without ADR files, no architectural decision has formal documentation, making all other reviews reference non-existent artifacts.","fix":"Architecture Division must create ADR-001 through ADR-012 files BEFORE any other plan work. Each ADR needs: title, status (confirmed), context, decision, consequences, alternatives considered. Recommend batch creation in priority order: ADR-001 (TS single stack), ADR-002 (PG single DB), ADR-003 (Redis working memory — needs clarification per QA-003 finding), then remaining 9 ADRs."}
{"ts":"0208T0411","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md","desc":"ROOT CAUSE ANALYSIS — The 45 issues cluster into 4 root causes: (RC-1) Static vs Dynamic gap: plan thoroughly documents structure (interfaces, schemas, tables) but not behavior (state transitions, error flows, shutdown, consolidation). Accounts for 13 of 21 HIGH issues. (RC-2) Factual drift: 3 HIGH issues from outdated or incorrect external references (deprecated model, wrong tokenizer, impossible latency). (RC-3) Security blind spots: auth model and defense-in-depth are sketched but not specified. Accounts for 3 HIGH + 4 MEDIUM. (RC-4) Missing formal artifacts: ADR files don't exist, types are referenced but not defined. Accounts for 2 HIGH + 2 MEDIUM.","fix":"Recommend 4 remediation tracks: Track A (RC-1): Add 'Behavior Specification' sections to plan for each component — state machines, error handling, lifecycle events. Consider 2 new ADRs: ADR-016 (Error Taxonomy & Classification), ADR-017 (Resilience Patterns: circuit breakers, graceful degradation, shutdown). Track B (RC-2): Research Division to verify all external claims. Track C (RC-3): Add ADR-018 (Authentication & Authorization). Track D (RC-4): Batch-create ADR-001 to ADR-012 files, define all core types in plan Section 3."}
{"ts":"0208T0412","from":"quality","type":"issue","sev":"HIGH","ref":"BACKLOG","desc":"PRIORITIZED ACTION PLAN for Architecture Division — 21 HIGH issues grouped into 7 work packages: [WP-1] ADR files (1 task: batch-create ADR-001~012, est. 1 cycle). [WP-2] Core type definitions (1 task: define Memory, Message, MemoryEngine, ToolResult, ReActEvent, SessionSummary, HealthStatus, SessionState in plan Section 3, est. 1 cycle). [WP-3] Factual corrections (3 tasks: update embedding model refs, fix tokenizer strategy, revise latency claims + IVFFlat formula, est. 1 cycle). [WP-4] ADR-003 Redis clarification (1 task: redefine Redis role as ephemeral cache with PG shadow, add relationship to ADR-002, est. 1 cycle). [WP-5] Error handling spec (2 tasks: ADR-016 Error Taxonomy + ReAct loop error handling, est. 1 cycle). [WP-6] Lifecycle spec (3 tasks: session state machine, graceful shutdown, memory consolidation algorithm, est. 2 cycles). [WP-7] Security spec (3 tasks: ADR-018 Auth Strategy, WebSocket auth, command args validation, est. 1 cycle). Suggested execution order: WP-1 → WP-2 → WP-3 → WP-4 → WP-5 → WP-6 → WP-7.","fix":"Coordinator should decompose these into BACKLOG tasks and assign to Architecture Division. Quality Division will re-review each WP output upon completion."}
{"ts":"0208T0412","from":"quality","type":"issue","sev":"MEDIUM","ref":"BACKLOG","desc":"RESEARCH DEPENDENCIES — 4 HIGH issues require Research Division input before Architecture can resolve: (1) RES-001 (pgvector IVFFlat vs HNSW) blocks IVFFlat formula fix. (2) RES-002 (tiktoken vs @anthropic-ai/tokenizer) blocks tokenizer strategy decision. (3) RES-003 (Gemini embedding model comparison) blocks embedding model update. (4) New research needed: Gemini Flash actual TTFT benchmarks to validate or revise <50ms claim. Suggest Research Division prioritize these 4 items.","fix":"Coordinator should move RES-001, RES-002, RES-003 to In Progress and add RES-006 (Gemini Flash TTFT benchmark) to Queued."}
{"ts":"0208T0413","from":"quality","type":"done","task":"QA-007","out":".axel-ops/comms/quality.jsonl","note":"Comprehensive review summary complete. Total: 45 issues (21 HIGH, 18 MEDIUM, 6 LOW) across 6 reviews. 2 CRITICAL quality gate findings issued. Root cause analysis identifies 4 systemic patterns. 7 work packages defined for Architecture Division with suggested execution order. 4 research dependencies identified. Plan finalization is BLOCKED until all 21 HIGH issues are resolved. Estimated remediation effort: 8-10 Division cycles."}
{"ts":"0208T0930","from":"quality","type":"claim","task":"QA-008","note":"Quality gate re-verification started — reviewing all WP-1~7 outputs (ADR-001~021, plan Section 3.5, factual corrections)"}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-QG2","note":"RESOLVED — ADR-001~012 all exist as proper ADR documents with Context, Decision, Alternatives Considered, Consequences sections. 12 files verified."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-001","note":"RESOLVED — IVFFlat replaced with HNSW in plan lines 746-747, 916. No IVFFlat formula remains in active spec."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-002","note":"RESOLVED — Decay parameters (accessStabilityK, recencyBoost etc) present in MemoryConfigSchema at plan line 569-572 and DecayConfig at line 967-974."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-003","note":"RESOLVED — ADR-001~012 batch created. All 12 confirmed ADRs have formal documents."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-011","note":"RESOLVED — No text-embedding-004 references remain in active plan spec. Only appears at line 1593 in migration context (correct usage)."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-012","note":"RESOLVED — tiktoken completely removed from plan. countTokens() at line 1155 is now async Promise<number> via Anthropic SDK."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-013","note":"RESOLVED — IVFFlat formula removed. HNSW with m=16, ef_construction=64 specified (lines 746-747)."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-014","note":"RESOLVED — Gemini Flash latency corrected to ~300-500ms via API (line 1193). No more '<50ms' claim."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-020","note":"RESOLVED — ToolDefinition type now in packages/core/src/types/tool.ts (line 423, line 1223). ERR-020 fully addressed."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-021","note":"RESOLVED — Migration direction corrected. text-embedding-004→gemini-embedding-001 at line 1593."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-024","note":"RESOLVED — Auth model fully specified in ADR-019: Static Bearer Token (Phase 0-1), JWT (Phase 2+), endpoint auth matrix."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-025","note":"RESOLVED — WebSocket auth specified in ADR-019: first-message auth with 5s timeout, code example provided."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-026","note":"RESOLVED — Command args/cwd validation specified in ADR-019 Section 5: control char check, dangerous flag check, cwd path validation + symlink check."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-027","note":"RESOLVED — SecurityConfigSchema extended with AuthConfig in ADR-019 Section 1."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-028","note":"RESOLVED — Webhook signature verification for Telegram (timingSafeEqual) and Discord (Ed25519) specified in ADR-019 Section 4."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-029","note":"RESOLVED — 4-layer prompt injection defense specified in ADR-019 Section 6. Regex-only approach upgraded to layered defense."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-030","note":"RESOLVED — Migration script changed to TypeScript-only via better-sqlite3 + parquet-wasm in ADR-019 Section 7. Python subprocess eliminated."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-035","note":"RESOLVED — Core domain types defined in plan Section 3.5 (lines 319-480): Memory, Message, SessionState, SessionSummary, ReActEvent, ToolCallRequest, ToolResult, ToolDefinition, HealthStatus, ComponentHealth, MemoryEngine, MemoryStats, TokenUsage."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-036","note":"RESOLVED — ReAct loop error handling fully specified in ADR-020: try/catch around LLM chat, tool execution, AbortSignal.timeout, tool error→LLM re-plan, maxIterations warning."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-037","note":"RESOLVED — AxelError hierarchy with 7 types defined in ADR-020: TransientError, PermanentError, ValidationError, AuthError, ProviderError, ToolError, TimeoutError. Classification matrix included."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-039","note":"RESOLVED — Memory consolidation L2→L3 algorithm specified in ADR-021 Section 3: session extraction via LLM, duplicate detection via cosine similarity >0.92, importance reinforcement."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-040","note":"RESOLVED — Graceful shutdown 4-phase sequence specified in ADR-021 Section 2: stop accepting → drain (15s) → flush state → close connections, 30s hard timeout."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-041","note":"RESOLVED — Session state machine with 7 states specified in ADR-021 Section 1: initializing→active→thinking→tool_executing→summarizing→ending→ended. Transition table included."}
{"ts":"0208T0935","from":"quality","type":"ack","ref":"ERR-043","note":"RESOLVED — Circuit breaker state machine specified in ADR-021 Section 4: closed→open→half_open, with config (failureThreshold, cooldownMs, halfOpenMaxProbes)."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1154","desc":"LlmProvider.embed() still defined at line 1154. QA-001 recommended removing embed() from LlmProvider since not all LLM providers offer embeddings. EmbeddingService (line 297) is the canonical embedding interface. Dual definition persists (ERR-005 unresolved).","fix":"Remove embed() from LlmProvider interface at line 1154. Embedding should only go through EmbeddingService (line 297-299)."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:258,1768,1911","desc":"Plan still references 'Vite + React' for WebChat in 3 locations (line 258, 1768, 1911) despite ADR-017 superseding to Svelte 5. ADR-017 plan impact section notes this change but plan body was not updated.","fix":"Update line 258: 'WebChat SPA (Vite + React)' → 'WebChat SPA (SvelteKit)'. Update line 1768: 'Vite + React' → 'SvelteKit (ADR-017)'. Update line 1911: strike React reference and add 'Superseded by ADR-017 → Svelte 5'."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1225,424","desc":"ToolDefinition interface defined twice: Section 3.5 line 424 (with readonly modifiers) and Section 4 Layer 6 line 1225 (without readonly). The two definitions have minor signature differences that could confuse implementing agents.","fix":"Remove duplicate at line 1225 and add cross-reference comment '// See Section 3.5 ToolDefinition' instead. Or ensure exact same definition at both locations."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1853","desc":"'모든 응답의 첫 토큰이 500ms 이내' success criterion (line 1853) not revised per QA-003 recommendation. Should specify percentile (p50 vs p95) since LLM TTFT is variable (~300-800ms).","fix":"Revise to '첫 토큰 500ms p50, 1000ms p95' or '첫 토큰 1초 이내 (p95)'. Current formulation implies 100% guarantee which is not achievable."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:1865","desc":"'Docker cold start: < 30초' (line 1865) still lacks qualifier per QA-003. Should specify 'with cached images'.","fix":"Change to 'Docker cold start: < 30초 (cached images 기준, 최초 배포 시 < 120초)'."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:1193","desc":"Gemini Flash ~300-500ms latency claim (line 1193) lacks research citation. Should reference a RES-XXX or external source for verifiability.","fix":"Add citation: 'Gemini Flash, ~300-500ms via API (RES-XXX pending benchmark)' or note this is an estimate."}
{"ts":"0208T0940","from":"quality","type":"issue","sev":"LOW","ref":"docs/plan/axel-project-plan.md:307-311","desc":"DI container bootstrap example (lines 307-311) still shows only 2 services (PgMemoryRepository, GeminiEmbeddingService). ERR-034 noted ~15 injectable services. ADR-006 acknowledges this gap but full bootstrap spec is deferred to FIX-MED.","fix":"No immediate fix needed — ERR-034 is tracked in FIX-MED. ADR-006 explicitly references ERR-034 and estimates ~20 services. Bootstrap will be fully specified before implementation."}
{"ts":"0208T0945","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md:192-197,ADR-003","desc":"ERR-010 (Redis vs PG single-DB principle) is NOT yet fully resolved. ADR-003 was updated to define Redis as ephemeral cache with shadow writes and degradation paths, which addresses the conceptual tension. HOWEVER, the plan body (Section 4 Layer 2, lines ~650-691) has NOT been updated to reflect ADR-003's new shadow write rules and degradation paths. Plan still describes Redis functions without mentioning PG shadow writes or fallback behavior. WP-4 (Redis role clarification) is assigned to Arch to update ADR-003 and plan body together.","fix":"WP-4 must update plan Layer 2 Redis section to match ADR-003's shadow write table and degradation paths. Until then, ERR-010 remains PARTIALLY resolved (ADR-003 updated, plan body not yet)."}
{"ts":"0208T0950","from":"quality","type":"issue","sev":"HIGH","ref":"CONSTITUTION:§3","desc":"QUALITY GATE RE-ASSESSMENT (5 gates): (1) Consistency: CONDITIONAL PASS — 21 HIGH contradictions resolved. 2 new MEDIUM inconsistencies found (React→Svelte refs, ToolDefinition duplicate). ERR-010 partially resolved pending WP-4. (2) Completeness: PASS — 20/23 claude_reports mapped (3 MEDIUM gaps remain as ERR-008, tracked in FIX-MED). Core domain types defined. (3) Traceability: PASS — ADR-001~021 all exist with cross-references. Module mapping table intact. (4) Feasibility: CONDITIONAL PASS — Deprecated model/tokenizer corrected. Latency claims improved but 2 success criteria lack qualifiers (ERR-017, ERR-018). (5) Sources: PASS — Research outputs RES-001~005 all have source URLs. ADRs reference research findings.","fix":"For full PASS on all gates: (a) WP-4 must resolve ERR-010 completely (plan body update), (b) FIX-MED must address remaining 5 MEDIUM issues found in this review plus existing 12 MEDIUM + 5 LOW from ERRORS.md."}
{"ts":"0208T0955","from":"quality","type":"done","task":"QA-008","out":"ADR-001~021 (21 files), docs/plan/axel-project-plan.md Section 3.5","note":"Quality gate re-verification complete. WP-1~7 outputs verified. 23 previously reported errors confirmed RESOLVED. 2 new HIGH issues found (ERR-010 partial, quality gate conditional), 5 new MEDIUM issues (LlmProvider.embed residual, React→Svelte plan refs, ToolDefinition duplicate, TTFT qualifier, Docker qualifier), 2 new LOW issues (latency citation, DI example). QUALITY GATE STATUS: 3 PASS, 2 CONDITIONAL PASS. ERR-QG1 downgraded from PENDING to CONDITIONAL — plan finalization is UNBLOCKED for WP-4, but final sign-off requires WP-4 completion + FIX-MED resolution of remaining MEDIUM issues. No CRITICAL issues remain. Massive improvement from QA-007 (21 HIGH → 0 HIGH resolved, 2 new HIGH conditional)."}
{"ts":"0208T1100","from":"quality","type":"claim","task":"QA-009-PREP","note":"FIX-MED not yet completed (no new commits on arch branch since 9568e5f). QA-009 blocked on FIX-MED. Preparing verification checklist for rapid QA-009 execution once FIX-MED lands."}
{"ts":"0208T1100","from":"quality","type":"issue","sev":"INFO","ref":"QA-009","desc":"QA-009 VERIFICATION CHECKLIST — 22 open errors mapped to specific plan locations for rapid post-FIX-MED verification. Key verification points: (1) ERR-005/ERR-022: LlmProvider.embed() at line 1160 must be removed, EmbeddingService at line 298-301 is canonical. (2) ERR-010: Plan Section 4 Layer 2 (lines ~192-198) must show PG shadow write pattern matching ADR-003. (3) ERR-047: Lines 259, 1774 must change 'Vite + React' to 'SvelteKit/Svelte 5'. (4) ERR-048: ToolDefinition at line 425 or 1231 must be consolidated to single definition. (5) ERR-017: Line 1859 TTFT criterion must add percentile qualifier (p50/p95). (6) ERR-018: Line 1871 Docker cold start must add 'cached images' qualifier. (7) ERR-034: Lines 308-312 DI container must enumerate all ~15-20 services. (8) Remaining 14 MEDIUM/LOW errors each have specific line references in plan for verification.","fix":"No fix needed — this is a verification preparation artifact for QA-009."}
{"ts":"0208T1300","from":"quality","type":"claim","task":"QA-009","note":"Final quality gate sign-off started. FIX-MED (commit 38472fa) landed — 22 MEDIUM/LOW issues resolved. Verifying all against QA-009-PREP checklist."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-004","note":"RESOLVED — Layer naming convention defined at plan lines 516-520: Turtle Stack uses TL0~TL10, Memory uses M0~M5."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-005","note":"RESOLVED — LlmProvider.embed() removed. Line 1249 explicitly states EmbeddingService is canonical. embed() no longer in LlmProvider interface."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-006","note":"RESOLVED — ContextDataProvider interface defined at lines 1124-1134. ContextAssembler uses DI injection (line 1135)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-007","note":"RESOLVED — channelMentions clarified at line 1032: 'distinct count of channel_mentions JSONB keys'."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-008","note":"RESOLVED — claude_reports #08 mapped to MCP Tool System (line 67), #13 to Home Assistant IoT Bridge (line 69), #21 to defineTool auto-register (line 75)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-009","note":"RESOLVED — InboundHandler type defined at lines 1556-1557."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-010","note":"RESOLVED — Plan body updated with shadow write table (lines 911-917), degradation path (lines 921-924), PG-first principle (line 198, 919). Fully aligns with ADR-003."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-015","note":"RESOLVED — Zod v3 API note added at line 580. v4 migration tracked in ADR-005."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-016","note":"RESOLVED — countTokens is async Promise<number> at line 1246. Clarification at line 1092."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-017","note":"RESOLVED — TTFT criterion revised to p50 < 500ms, p95 < 1,500ms at line 1983."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-018","note":"RESOLVED — Docker cold start qualifier added: '< 30초 (cached images 기준, 최초 배포 시 < 120초)' at line 1995."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-019","note":"RESOLVED — tsdown correctly attributed to Rolldown ecosystem at line 539."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-022","note":"RESOLVED — EmbeddingService.embed() unified: singular embed() + embedBatch() at lines 299-300. LlmProvider no longer has embed()."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-023","note":"RESOLVED — Triple layer numbering clarified at lines 516-520 with explicit naming convention."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-031","note":"RESOLVED — Command allowlist tightened at lines 648-654. docker/npm excluded from default. Read-only commands only."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-032","note":"RESOLVED — Credential redaction spec at line 1651."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-033","note":"RESOLVED — Security test cases expanded to 11 items at lines 1828-1839 (JWT, WS auth, rate limiter, CORS, redaction)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-034","note":"RESOLVED — DI container expanded to ~20 services at lines 308-338 with full wiring."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-042","note":"RESOLVED — AxelChannel reconnection lifecycle at lines 1503-1513 (onDisconnect, onReconnect, exponential backoff)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-044","note":"RESOLVED — Streaming pipeline error handling at lines 1435-1437."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-045","note":"RESOLVED — PersonaEngine hot-reload mechanism at lines 1201-1207 (fs.watch, debounce, Zod validation, atomic write)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-046","note":"RESOLVED — Meta Memory feedback loop at lines 999-1003 (4-step: access patterns → materialized view → prefetch → positive feedback)."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-047","note":"RESOLVED — React→Svelte refs fixed. Line 259 SvelteKit, line 1898 SvelteKit, line 2041-2042 Svelte 5. No React references remain."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-048","note":"RESOLVED — ToolDefinition consolidated to single definition at line 452. Line 1316 references Section 3.5 instead of duplicating."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-049","note":"RESOLVED — Gemini Flash latency at line 1286 now reads '~300-500ms via API — 추정치, 실측 벤치마크 필요'."}
{"ts":"0208T1330","from":"quality","type":"ack","ref":"ERR-QG1","note":"RESOLVED — All 5 CONSTITUTION §3 quality gates now PASS. Consistency: no contradictions remain. Completeness: 23/23 mapped, all open items resolved. Traceability: ADR-001~021 all exist. Feasibility: all factual errors corrected with qualifiers. Sources: RES-001~005 all have source URLs."}
{"ts":"0208T1335","from":"quality","type":"done","task":"QA-009","out":"docs/plan/axel-project-plan.md, docs/adr/001-021, docs/research/RES-001-005, docs/plan/openapi-v1.yaml, docs/plan/websocket-protocol.md, docs/plan/migration-strategy.md","note":"FINAL QUALITY GATE SIGN-OFF: ALL 5 GATES PASS. (1) Consistency: PASS — no ADR contradictions, no internal inconsistencies, Redis/PG tension resolved with shadow write table. (2) Completeness: PASS — 23/23 claude_reports mapped, 5/5 open items resolved, 13 core domain types defined. (3) Traceability: PASS — ADR-001~021 (21 files) all exist with cross-references, module mapping complete. (4) Feasibility: PASS — deprecated models corrected, latency claims qualified with p50/p95, Docker cold start qualified. (5) Sources: PASS — all 5 research documents contain multiple source URLs. FIX-MED 22 issues ALL VERIFIED RESOLVED. ERR-QG1 status: RESOLVED. Total errors resolved across all cycles: 48 (from 48 open to 0). PLAN FINALIZATION APPROVED."}
{"ts":"0208T2100","from":"quality","type":"claim","task":"QA-010-PROACTIVE","note":"Proactive review: embedding dimension 768d→3072d impact analysis (per AUDIT-001 scope) + post-QA-009 drift check"}
{"ts":"0208T2105","from":"quality","type":"ack","ref":"DRIFT-CHECK","note":"Post-QA-009 drift check PASS. 5 commits since QA-009 (9ac0aeb): all chore(ops) — version bump v2.0→v2.0.1 (cosmetic), Audit Division creation, coordinator cycles. No docs/plan or docs/adr content changes. No MISSION.md violations."}
{"ts":"0208T2110","from":"quality","type":"issue","sev":"HIGH","ref":"docs/plan/axel-project-plan.md,docs/adr/016-embedding-model-selection.md","desc":"EMBEDDING DIMENSION 768d→3072d IMPACT ANALYSIS: Human directive (broadcast 0208T1700) overrides ADR-016 dimension choice from 768d (Matryoshka truncation) to 3072d (full dimension). 58 references to 768d found across 7 files. Impact categories: (A) HARD VALUES requiring change (11 locations): plan line 301 (EmbeddingService.dimension), line 594 (embeddingDimension default), line 770 (vector(768) SQL), line 978-979 (768d comparison text), line 1715 (re-embed decision), line 1721 (dimension claim), line 2023+2038 (ADR-016 summary). ADR-016 lines 20,36,41,44,47,53,65,123,140. ADR-002 line 36. ADR-013 line 143. migration-strategy.md lines 163,463,474. (B) CASCADING IMPACTS (4 areas requiring re-analysis): (1) Storage: 3072d is 4x larger than 768d — vector(3072) row size ~12.3KB vs ~3.1KB. 100K vectors = ~1.17GB vs ~293MB. pgvector index memory and build time increase proportionally. (2) HNSW memory formula at RES-001 line 150 uses 1536d (neither 768d nor 3072d) — this was ALREADY WRONG before the 768d→3072d change. Must recalculate for 3072d. (3) Migration cost: re-embed API call parameters change (no outputDimensionality param needed), but token cost unchanged. (4) IVFFlat/HNSW index parameters may need re-tuning for 3072d vectors.","fix":"Architecture Division should: (1) Update ADR-016 Decision section: change 768d→3072d, revise Dimension Choice rationale (human override: full precision chosen despite storage cost), update API Usage Pattern (remove outputDimensionality param), update Consequences (4x storage increase). (2) Update plan body: all 11 hard-value locations listed above. (3) Update ADR-002: vector(768)→vector(3072). (4) Update ADR-013: 768d→3072d. (5) Update migration-strategy.md: 3 locations. (6) Fix RES-001 line 150: HNSW memory calculation should use 3072d, not 1536d. (7) Recalculate storage estimates for 100K vectors at 3072d. (8) Verify HNSW m=16, ef_construction=64 params are still optimal for 3072d (higher dimensions may benefit from higher m)."}
{"ts":"0208T2110","from":"quality","type":"issue","sev":"HIGH","ref":"docs/research/RES-001-pgvector-index-comparison.md:150","desc":"RES-001 HNSW memory calculation uses 1536 dimensions (line 150) which matches NEITHER the current 768d setting NOR the incoming 3072d. This was a pre-existing error never caught in QA-001~QA-009 because the plan body uses 768d and the research report uses 1536d independently. The formula '(1536 × 4) + (16 × 2 × 4) = 6272 bytes/vector' should be recalculated for the actual dimension. For 3072d: (3072 × 4) + (16 × 2 × 4) = 12,416 bytes/vector. 100K vectors ≈ 1.18GB (vs 597MB at 1536d, vs 150MB at 768d). This 4x increase from the original 768d has deployment implications for Phase 0 VPS (4 vCPU, 8GB RAM).","fix":"(1) Fix RES-001 line 150: change 1536 to 3072 and recalculate all memory estimates. (2) Update IVFFlat memory estimate at line 156-157 for 3072d. (3) Update Layer-Specific Configuration table (lines 161-168) with 3072d-adjusted memory estimates. (4) Verify Phase 0 VPS (8GB RAM) can accommodate 3072d HNSW index for initial 1K-10K vectors — likely yes, but should be documented."}
{"ts":"0208T2110","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/research/RES-003-gemini-embedding-comparison.md:141,168,180,203","desc":"RES-003 research report recommends '768 dimensions for Axel' (line 141) and shows code examples with outputDimensionality: 768 (lines 168, 180) and vector(768) SQL (line 203). This research report informed ADR-016's original 768d choice. With the human override to 3072d, the research report's recommendation is now SUPERSEDED. The report itself should NOT be modified (research outputs are historical records), but ADR-016 should explicitly note that it overrides RES-003's recommendation per human directive.","fix":"ADR-016 should add a note: '768d was originally recommended by RES-003 for storage efficiency. Human directive (2026-02-08) overrides to 3072d full dimension for maximum embedding quality. The 4x storage increase is accepted as a trade-off.'"}
{"ts":"0208T2110","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:98,1705","desc":"Historical axnmihn data references '768d' (plan lines 98, 978, 1705). These describe axnmihn's EXISTING state (ChromaDB with text-embedding-004 at 768d) and should remain as-is — they are factual descriptions of the source system. However, the migration section (line 1715, 1721) conflates source dimension with target dimension. Line 1721 says '768d 차원 유지 → pgvector 컬럼 타입 변경 불필요' which is WRONG with 3072d target — the column type WILL need to change from what was planned.","fix":"(1) Keep lines 98, 978 as-is (axnmihn historical facts). (2) Update line 979: 'Axel: pgvector (같은 DB), 768d' → 'Axel: pgvector (같은 DB), 3072d'. (3) Update line 1715: 'Re-embed (gemini-embedding-001, 768d)' → 'Re-embed (gemini-embedding-001, 3072d)'. (4) Update line 1721: remove '768d 차원 유지' claim, note that column type changes to vector(3072)."}
{"ts":"0208T2110","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/v2-open-items-decisions.md:11,15,21,22,35,176","desc":"v2-open-items-decisions.md contains 6 references to 768d dimension choice (lines 11, 15, 21, 22, 35, 176). This is a PLAN-001 historical decision document. Lines 21-22 specifically justify 768d with axnmihn compatibility and storage arguments. Line 35 notes '필요 시 3072d full dimension으로 업그레이드 가능'. With the human override, this document's dimension recommendation is superseded.","fix":"Add a note at the top of v2-open-items-decisions.md: '> Note: Embedding dimension updated from 768d to 3072d per human directive (2026-02-08). See ADR-016 revision.' The existing 768d reasoning can remain as historical context showing the trade-off analysis."}
{"ts":"0208T2115","from":"quality","type":"done","task":"QA-010-PROACTIVE","out":"7 files analyzed, 58 references catalogued, 2 HIGH + 3 MEDIUM issues","note":"Proactive review complete. SUMMARY: (1) Post-QA-009 drift check PASS — no content changes, only ops commits. (2) Embedding 768d→3072d impact: 58 references across 7 files need updating (11 hard values + 47 contextual). 2 HIGH issues (comprehensive update list for Arch, RES-001 dimension mismatch was pre-existing). 3 MEDIUM issues (RES-003 superseded recommendation, migration section conflation, v2-open-items historical doc). Audit Division (AUDIT-001) is the primary assignee for this correction work — these findings provide Quality Division's verification checklist for when AUDIT-001 outputs land. No new CRITICAL issues. Quality gates remain PASS conditional on 768d→3072d corrections being applied consistently."}
{"ts":"0209T0050","from":"quality","type":"claim","task":"QA-011-PREP","note":"FIX-AUDIT not yet completed (no done msg in arch.jsonl, no new commits). QA-011 blocked. Proactively preparing baseline + verification checklist for rapid execution once FIX-AUDIT lands."}
{"ts":"0209T0055","from":"quality","type":"issue","sev":"INFO","ref":"QA-011","desc":"QA-011 VERIFICATION CHECKLIST — FIX-AUDIT must correct 7 errors (ERR-050~056). Baseline analysis shows: (A) STILL NEEDS FIX (5 items): ERR-050 v2-open-items:40-45 React→Svelte, ERR-051 ADR-016:28 maxInputTokens 8192→2048, ERR-053 migration-strategy:180-187 IVFFlat params 3072d recalc, ERR-055 ADR-016:69 rateLimitRpm 1500→free tier 5-15 RPM, ERR-056 v2-open-items override note should be at document top (currently nested at line 34-36). (B) ALREADY RESOLVED by EMBED-3072 (2 items): ERR-052 plan:1721-1722 migration logic — already updated to 3072d/vector(3072). ERR-054 ADR-016:~123 index reuse claim — already removed, re-embed required stated. (C) NEW OBSERVATION: ERR-052 and ERR-054 may not need FIX-AUDIT action if already addressed by EMBED-3072 — Arch should confirm.","fix":"No fix needed — verification preparation artifact."}
{"ts":"0209T0300","from":"quality","type":"claim","task":"QA-011","note":"FIX-AUDIT verification started. FIX-AUDIT done (a59952b) + AUDIT-002 done (322b29f). All 3 branches merged. Verifying ERR-050~056 + AUDIT-002 overlap + ERR-057~059 residual."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-050","note":"RESOLVED — v2-open-items Section 2 title changed to '~~React~~ → Svelte 5', SUPERSEDED notice added, summary table updated."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-051","note":"RESOLVED — ADR-016:28 max input tokens corrected to 2,048."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-052","note":"RESOLVED — Already corrected by EMBED-3072. Plan body lines 1715-1722 all reference 3072d correctly."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-053","note":"RESOLVED — migration-strategy Migration 003 SQL updated to HNSW (m=16, ef_construction=64) with 3072d memory calculation. HOWEVER: IVFFlat Index Note section (lines 377-393) and Execution Order (line 372) still reference IVFFlat — see new issue below."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-054","note":"RESOLVED — Already corrected by EMBED-3072. ADR-016 Consequences no longer claims index reuse."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-055","note":"RESOLVED — ADR-016:70 rateLimitRpm 1500 now clearly labeled as 'Gemini paid tier' with 'Free tier: ~5-15 RPM (RES-003)' comment."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-056","note":"RESOLVED — v2-open-items: Section 1 title updated to '3072d', line 34-36 Dimension Override Note added, summary table at line 178 updated to '3072d'."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"AUD-035","note":"RESOLVED — Same as ERR-051. ADR-016:28 max input tokens = 2,048."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"AUD-036","note":"PARTIALLY RESOLVED — Plan body (HNSW), ADR-002 (HNSW), migration-strategy SQL (HNSW) are aligned. ADR-013:144 and :171-174 still say IVFFlat. migration-strategy lines 372, 377-393 still reference IVFFlat in text. 3 of 4 sources aligned; ADR-013 remains unupdated. See new MEDIUM issue."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"AUD-037","note":"ACCEPTABLE — RES-001 is a research document (historical record). Plan and migration-strategy use correct 3072d calculations. No plan/ADR correction needed."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"AUD-038","note":"RESOLVED — Same as ERR-050. v2-open-items React→Svelte fully updated with SUPERSEDED notice."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-057","note":"RESOLVED — ADR-016:29 now reads '128–3,072 (유연). 추천값: 768 / 1,536 / 3,072'. 256 removed from recommended list. FIX-AUDIT correctly applied AUD-023."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-058","note":"SUBSTANTIALLY RESOLVED — ADR-016:31 now reads '68.16 (GA model 3072d)' with experimental 68.32 separately noted. Micro-discrepancy (68.16 vs 68.17 per some sources) has zero practical impact. Downgraded from MEDIUM to LOW."}
{"ts":"0209T0330","from":"quality","type":"ack","ref":"ERR-059","note":"ACCEPTABLE — RES-001 uses 1536d in memory calc. This is a historical research document. Plan/migration-strategy use correct 3072d values. No action required."}
{"ts":"0209T0330","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/adr/013-six-layer-memory-architecture.md:144,171-174","desc":"ADR-013 Layer 3 comparison table (line 144) says 'IVFFlat (lists=100, 1K vectors 기준)' and IVFFlat vs HNSW section (lines 171-174) recommends IVFFlat for 1K scale. Plan body (line 787-788), ADR-002 (line 77), and migration-strategy SQL (lines 185-187) all use HNSW. ADR-013 is the only remaining document that recommends IVFFlat. Not blocking for plan closure but should be corrected before implementation.","fix":"Update ADR-013:144 to 'HNSW (m=16, ef_construction=64)'. Update lines 171-174 to note HNSW is now the recommended index per RES-001 and plan body. Consider adding a note: 'Originally IVFFlat was considered, revised to HNSW per RES-001 findings'."}
{"ts":"0209T0330","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/migration-strategy.md:372,377-393","desc":"migration-strategy Execution Order (line 372) says 'Rebuild IVFFlat index (REINDEX)' and IVFFlat Index Note section (lines 377-393) contains full IVFFlat discussion with SQL example. Migration 003 SQL (line 185-187) was correctly updated to HNSW by FIX-AUDIT, but these downstream text sections were not updated. Inconsistency within the same document.","fix":"Update line 372: 'Rebuild IVFFlat index' → 'Rebuild HNSW index'. Rename/rewrite IVFFlat Index Note section to HNSW context. Update SQL example at lines 387-389 to HNSW. Consider noting that HNSW does not have the same cluster-dependent initialization issue as IVFFlat."}
{"ts":"0209T0330","from":"quality","type":"issue","sev":"MEDIUM","ref":"docs/plan/axel-project-plan.md:843-853 vs docs/plan/migration-strategy.md:285-302","desc":"hot_memories materialized view SQL differs between plan body and migration-strategy. Plan body uses INNER JOIN via LATERAL+FROM (excludes memories with empty channel_mentions). migration-strategy uses LEFT JOIN (includes all, COALESCE for 0). Migration-strategy version is semantically more correct as it preserves all recent memories regardless of channel_mentions. AUDIT-002 AUD-039 finding persists.","fix":"Align plan body hot_memories MV with migration-strategy version (LEFT JOIN). This ensures all recently accessed memories appear in hot_memories, not just cross-channel ones."}
{"ts":"0209T0335","from":"quality","type":"done","task":"QA-011","out":"docs/adr/016-embedding-model-selection.md, docs/plan/v2-open-items-decisions.md, docs/plan/migration-strategy.md, docs/plan/axel-project-plan.md, docs/adr/013-six-layer-memory-architecture.md, docs/adr/002-postgresql-single-db.md","note":"QA-011 FINAL VERIFICATION COMPLETE. ERR-050~056: ALL 7 RESOLVED. AUDIT-002 HIGH overlap: AUD-035 RESOLVED, AUD-036 PARTIALLY RESOLVED (ADR-013 IVFFlat remnant), AUD-037 ACCEPTABLE (research doc), AUD-038 RESOLVED. ERR-057: RESOLVED. ERR-058: SUBSTANTIALLY RESOLVED (68.16 vs 68.17 micro-discrepancy, LOW impact). ERR-059: ACCEPTABLE (research doc historical). 3 new MEDIUM issues found (ADR-013 IVFFlat, migration-strategy IVFFlat text, hot_memories MV SQL diff). QUALITY GATE STATUS: 4 PASS (Completeness, Traceability, Feasibility, Sources), 1 CONDITIONAL PASS (Consistency — 3 MEDIUM remnants, non-blocking). PLAN CLOSURE APPROVED with advisory: correct 3 MEDIUM items before implementation Phase 1 kickoff. No CRITICAL or HIGH issues remain. Total resolved this cycle: 7 ERR + 2 AUD HIGH = 9 items."}
{"ts":"0208C35","from":"quality","type":"claim","task":"QA-012","note":"Phase B code review: CORE-001 (domain types) + CORE-002 (decay) + CORE-005 (persona). 7-perspective framework + CONSTITUTION compliance."}
{"ts":"0208C35","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/types/react.ts:24","desc":"Plan §3.5 defines ReActEvent error variant as { error: AxelError } (class type), but implementation uses { error: AxelErrorInfo } (serializable interface). This is a plan-code drift. The implementation choice (serializable AxelErrorInfo) is arguably better for streaming/serialization, but diverges from plan spec.","fix":"Architect should update plan §3.5 ReActEvent error variant to use AxelErrorInfo instead of AxelError, or document this as an intentional deviation in PLAN_SYNC.md."}
{"ts":"0208C35","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/types/tool.ts:18","desc":"Plan §3.5 defines ToolDefinition.inputSchema as z.ZodSchema and includes handler field. Implementation uses inputSchema: unknown and omits handler. Dev-Core noted this is intentional per Rule 9 (Zod in infra layer), but plan §3.5 should be updated to reflect this decision.","fix":"Architect should update plan §3.5 ToolDefinition to (1) inputSchema: unknown with comment about Zod in infra, (2) remove handler field from core type (handler belongs to tool registry in infra/orchestrator). Add PLAN_SYNC drift entry."}
{"ts":"0208C35","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/decay/calculator.ts:26","desc":"Nullish coalescing branch (config.typeMultipliers[memoryType] ?? 1.0) never triggers with DEFAULT_DECAY_CONFIG since all 4 MemoryType keys are present. Branch coverage at 75%. This is defensive coding and acceptable, but could use a test with a custom config missing a key.","fix":"Optional: Add a test in calculator.test.ts with a config where typeMultipliers is missing a key to exercise the ?? fallback branch."}
{"ts":"0208C35","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/decay/types.ts:30","desc":"DecayConfigSchema.typeMultipliers uses z.record(z.string(), z.number()) which is looser than the actual MemoryType union. Any string key is accepted at runtime, not just 'fact'|'preference'|'insight'|'conversation'. This could allow misconfigured keys to slip through validation.","fix":"Consider tightening to z.record(z.enum(['fact','preference','insight','conversation']), z.number()) to enforce MemoryType keys at schema validation level. Low priority since DEFAULT_DECAY_CONFIG is correct."}
{"ts":"0208C35","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/persona/engine.ts:41","desc":"CHANNEL_ADAPTATIONS is accessed with bracket notation (CHANNEL_ADAPTATIONS[channel]) which returns ChannelAdaptation|undefined. The undefined case is handled (line 84: else branch), but TypeScript strict mode with noUncheckedIndexedAccess would require explicit undefined check. Currently works because the Readonly<Record<string, ChannelAdaptation>> typing makes the indexed access typed.","fix":"No action required — code is correct. The Readonly<Record<string,T>> type makes bracket access return T (not T|undefined) without noUncheckedIndexedAccess. If noUncheckedIndexedAccess is enabled project-wide, this would need adjustment."}
{"ts":"0208C35","from":"quality","type":"test-result","pkg":"core","tests":121,"pass":121,"fail":0,"coverage":"100% stmts, 93.33% branch, 100% funcs, 100% lines (excludes types/ and index.ts per vitest.config.ts)"}
{"ts":"0208C35","from":"quality","type":"done","task":"QA-012","out":"packages/core/src/types/*.ts, packages/core/src/decay/*.ts, packages/core/src/persona/*.ts (18 src + 16 test files)","note":"QA-012 COMPLETE. Phase B code review for CORE-001+CORE-002+CORE-005. RESULTS: 0 CRITICAL, 0 HIGH, 2 MEDIUM (plan-code drift), 3 LOW. ALL CONSTITUTION gates PASS: (1) Rule 8 TDD — test commits precede src commits for all 3 tasks, (2) Rule 9 — no cross-package imports, only zod (external npm), (3) Rule 10 — 121 tests pass, Biome clean, tsc clean, coverage 93%+ (above 90% target), (4) Rule 14 — max file 99 lines (errors.ts), well under 400. ADR-015 formula correctly implemented with 5 regression scenarios verified. Plan §3.5 interfaces faithfully implemented with 2 justified deviations (AxelErrorInfo serialization, ToolDefinition handler/schema). Overall: EXCELLENT quality. No blocking issues."}
{"ts":"0208C35","from":"quality","type":"coverage-report","core":"100% stmts / 93% branch / 100% funcs / 100% lines","infra":"N/A (not started)","channels":"N/A (not started)","gateway":"N/A (not started)"}
{"ts":"0208C36","from":"quality","type":"claim","task":"QA-013","note":"Phase B code review: CORE-003 memory layers M0-M5. 7-perspective framework + CONSTITUTION compliance + ADR-013 interface verification."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/memory/types.ts:141","desc":"ADR-013 defines SemanticMemory.decay() parameter as DecayConfig, but implementation uses DecayRunConfig (types.ts:137-139). Minor name drift from ADR spec. Both define threshold field but naming diverges.","fix":"Architect should update ADR-013 TypeScript interface snippet to use DecayRunConfig, or add PLAN_SYNC drift entry acknowledging the rename. Low impact — interface contract shape is correct."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/memory/episodic-memory.ts:43-44","desc":"Type assertion workaround to mutate readonly fields: (session as { summary: string | null }).summary = summary. StoredSession has readonly fields but endSession() needs to update them. Internally safe but breaks the readonly contract at the type system level.","fix":"Make StoredSession.summary and .endedAt mutable (remove readonly on those fields only). The internal mutable state pattern is appropriate for an in-memory store — readonly should apply to external consumers via the interface, not internal mutation."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"MEDIUM","ref":".axel-ops/PLAN_SYNC.md:103-108","desc":"B.3 Memory Layers status still NOT_STARTED — needs update to IN_SYNC after CORE-003 completion. SYNC-003 is already queued in BACKLOG for this update.","fix":"SYNC-003 will resolve. No additional action needed — noting for traceability."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/memory/stream-buffer.ts:16-21","desc":"consume() reads events but does not remove them from the buffer array. Semantically this is a peek operation, not consume. Redis Streams XREADGROUP would mark entries as consumed via ACK. Acceptable for in-memory stub.","fix":"No fix needed for stub. Document for infra implementation: production StreamBuffer.consume() must use XREADGROUP with ACK for true consumption semantics."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/memory/meta-memory.ts:62-64","desc":"pruneOldPatterns() always returns 0 since in-memory stub has no timestamp tracking on patterns. Test only verifies typeof === 'number', not actual pruning behavior. Acceptable for stub.","fix":"Optional: add createdAt timestamp to pattern storage for more realistic stub behavior. Low priority."}
{"ts":"0208C36","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/memory/semantic-memory.ts:57","desc":"search() applies limit via slice(0, limit) BEFORE computing scores, meaning highest-scoring results may be excluded. Production pgvector impl must ORDER BY similarity THEN limit.","fix":"No fix needed for in-memory stub. Infra implementation MUST score-then-limit: ORDER BY embedding <=> $1 LIMIT n."}
{"ts":"0208C36","from":"quality","type":"test-result","pkg":"core","tests":241,"pass":241,"fail":0,"coverage":"100% stmt, 95% branch, 100% func, 100% lines (dev-core reported; @vitest/coverage-v8 not available on quality worktree)"}
{"ts":"0208C36","from":"quality","type":"done","task":"QA-013","out":"packages/core/src/memory/*.ts (8 src files), packages/core/tests/memory/*.ts (7 test files)","note":"QA-013 COMPLETE. Phase B code review for CORE-003 (memory layers M0-M5). RESULTS: 0 CRITICAL, 0 HIGH, 3 MEDIUM, 3 LOW. ALL CONSTITUTION gates PASS: (1) Rule 8 TDD — test commit c719a22 (03:31:05) precedes src commit abd5878 (03:33:08), delta +2m03s, (2) Rule 9 — no cross-package imports, only relative paths within core/, (3) Rule 10 — 241 tests pass, Biome clean, tsc clean, coverage 100% stmt / 95% branch (above 90% target), (4) Rule 14 — max file 238 lines (types.ts), well under 400. ADR-013 6-layer architecture faithfully implemented: all 6 interfaces (StreamBuffer, WorkingMemory, EpisodicMemory, SemanticMemory, ConceptualMemory, MetaMemory) have in-memory stubs with layerName discriminant and healthCheck(). Hybrid search (0.7 vector + 0.3 text), BFS graph traversal with cycle detection, 20-turn working memory window, and channel diversity tracking all verified. Overall: EXCELLENT quality."}
{"ts":"0208C36","from":"quality","type":"coverage-report","core":"100% stmts / 95% branch / 100% funcs / 100% lines","infra":"N/A (not started)","channels":"N/A (not started)","gateway":"N/A (not started)"}
{"ts":"0208C38","from":"quality","type":"claim","task":"QA-014-PROACTIVE","note":"Proactive Phase B code review: CORE-004 context assembly. 7-perspective framework + CONSTITUTION compliance. CORE-004 done report detected on div/dev-core branch (commit 81c7013)."}
{"ts":"0208C38","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/context/types.ts:72","desc":"Plan §3.3 defines ContextDataProvider.getMetaMemory() return type as Promise<readonly PrefetchedMemory[]>, but implementation uses Promise<readonly HotMemory[]>. Arch interface-contract (C32) also specifies PrefetchedMemory. HotMemory type has different fields (memoryId, uuid, content, accessCount, channelDiversity) vs plan's PrefetchedMemory which may have additional context fields.","fix":"Architect should either (1) update plan §3.3 ContextDataProvider to use HotMemory, or (2) create a PrefetchedMemory type alias in memory/types.ts mapping to HotMemory. Add PLAN_SYNC drift entry."}
{"ts":"0208C38","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/context/assembler.ts:165-181","desc":"truncateToFit() binary search performs O(log n) async counter.count() calls. For 200K char text, ~17 API calls × 50-100ms = 0.85-1.7s per section truncation. ADR-012 specifies LRU token cache (1000 entries) to minimize API calls, but TokenCounter interface has no caching — caching must be in the infra implementation. However, binary search re-counts substrings that won't benefit from LRU cache (each candidate is unique). Consider: (1) use estimate() to narrow binary search initial range, or (2) use a proportional heuristic (estimate_ratio * text.length) as starting point.","fix":"Low urgency for in-memory stub. For production infra TokenCounter, consider adding an initial estimate-based narrowing step before binary search to reduce count() calls from ~17 to ~5. e.g. let high = Math.ceil(maxTokens / estimate_ratio * text.length)."}
{"ts":"0208C38","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/context/assembler.ts:160-180","desc":"formatters (formatTurns, formatStreamEvents, etc.) are 7 pure functions inline in assembler.ts. Currently 242 lines total — well under 400 limit. If formatters grow with richer formatting or i18n, consider extracting to a separate formatters.ts module.","fix":"No action needed now. Flag for future refactoring if assembler.ts approaches 300+ lines."}
{"ts":"0208C38","from":"quality","type":"test-result","pkg":"core","tests":289,"pass":289,"fail":0,"coverage":"100% stmt, 100% branch, 100% func, 100% lines (context module). Global: 100% stmt, 95.87% branch, 100% func, 100% lines (dev-core reported)"}
{"ts":"0208C38","from":"quality","type":"done","task":"QA-014-PROACTIVE","out":"packages/core/src/context/{types,assembler,index}.ts (3 src files), packages/core/tests/context/{types,assembler}.test.ts (2 test files)","note":"QA-014-PROACTIVE COMPLETE. Proactive Phase B code review for CORE-004 (context assembly). RESULTS: 0 CRITICAL, 0 HIGH, 2 MEDIUM, 1 LOW. ALL CONSTITUTION gates PASS: (1) Rule 8 TDD — test commit 05daa1d (03:45:04) precedes src commit a0f498f (03:46:36), delta +1m32s, (2) Rule 9 — no cross-package imports, only relative paths + zod, (3) Rule 10 — 289 tests pass, Biome clean, tsc clean, coverage 100% stmt / 100% branch (above 90% target), (4) Rule 14 — max file 242 lines (assembler.ts), well under 400. Plan §3.3 + ADR-012 faithfully implemented: ContextBudget Zod schema (8 slots, 76K total), ContextDataProvider DI contract (7 methods), TokenCounter (count/estimate), ContextAssembler priority-ordered assembly with binary-search truncation. Constructor injection pattern. 48 new tests with comprehensive edge cases. Overall: EXCELLENT quality."}
{"ts":"0208C38","from":"quality","type":"coverage-report","core":"100% stmts / 95.87% branch / 100% funcs / 100% lines","infra":"N/A (not started)","channels":"N/A (not started)","gateway":"N/A (not started)"}
{"ts":"0208C39","from":"quality","type":"claim","task":"QA-015-PROACTIVE","note":"Proactive Phase B code review: CORE-006 orchestrator module. 7-perspective framework + CONSTITUTION compliance. CORE-006 done report detected on div/dev-core branch (commit e53a4e2)."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/orchestrator/types.ts:79-92","desc":"Plan §4.6 LlmProvider interface specifies 4 members: id (readonly string), chat(), countTokens(), healthCheck(). Implementation defines only chat(). Additionally plan's ChatParams has 7 fields (messages, model, maxTokens, temperature, tools, systemPrompt, thinkingBudget), but implementation's LlmChatParams has only 2 (messages, tools). This is a deliberate simplification — core defines the minimal DI contract, infra will add provider-specific params. However, the plan-code divergence should be tracked.","fix":"Architect should add PLAN_SYNC drift entry noting that core/orchestrator/types.ts LlmProvider is a narrowed DI contract (chat-only). Full LlmProvider per plan §4.6 will live in packages/infra/. No code change needed."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/orchestrator/types.ts:40","desc":"Plan §4.6 UnifiedSession does not include turnCount field, but implementation adds it. ADR-014 also omits turnCount from its UnifiedSession spec. The field is useful (SessionRouter uses it for activity tracking), but represents a plan-code drift.","fix":"Architect should update ADR-014 UnifiedSession interface to include turnCount: number. Minor drift — field is sensible and used by tests."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/orchestrator/types.ts:44-48","desc":"Plan §4.6 SessionRouter interface defines 3 methods: resolveSession(returns UnifiedSession), switchChannel(), endSession(). Implementation replaces this with SessionStore DI interface (5 methods: resolve, updateActivity, getActive, getStats, end) returning ResolvedSession instead of UnifiedSession, and drops switchChannel() — channel switching is handled implicitly in resolve(). SessionRouter class becomes a thin wrapper over SessionStore. Design improvement over plan (cleaner separation of concerns), but significant interface divergence.","fix":"Architect should update PLAN_SYNC.md to document: (1) SessionRouter is now a class wrapping SessionStore (DI contract), not a standalone interface. (2) switchChannel() absorbed into resolve(). (3) resolveSession() returns ResolvedSession (richer than UnifiedSession). No code change needed — the implementation is an improvement."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/core/src/orchestrator/react-loop.ts:70-77","desc":"Tool error message construction uses empty sessionId ('') and turnId (0) in makeToolMessage/makeToolErrorMessage. These messages are appended to the conversation for LLM context, so the placeholder values are functionally acceptable. However, if downstream code filters or groups by sessionId/turnId, these tool messages would be lost or miscategorized.","fix":"Consider accepting sessionId from the original message context in ReActLoopParams, or using a sentinel value like 'tool-internal'. Low urgency — acceptable for core contract, infra implementation should provide real sessionId."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/orchestrator/react-loop.ts:49-57","desc":"chunkToEvent() uses type assertion (chunk.content as string). The LlmChatChunk discriminated union already types content correctly per variant, but the function accepts {type: string, content: unknown} — a wider type than necessary. This loses type safety from the LlmChatChunk union.","fix":"Change function signature to accept LlmChatChunk directly instead of the widened type. The function is only called with LlmChatChunk values anyway. Low priority."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/orchestrator/react-loop.ts:233","desc":"exponentialBackoff formula is 100 * 2^attempt, capped at 5s. Plan §4.6 and ADR-020 specify exponential backoff but don't prescribe exact base/cap. The implementation is reasonable (100ms, 200ms, 400ms, 800ms, 1.6s, 3.2s, 5s). Token usage in doneEvent() is hardcoded to all zeros — production implementation should aggregate from LLM responses.","fix":"No fix needed for zeros in stub. Document that infra LlmProvider implementation must yield token usage metadata that reactLoop aggregates into the final done event."}
{"ts":"0208C39","from":"quality","type":"issue","sev":"LOW","ref":"packages/core/src/orchestrator/session-router.ts:1-78","desc":"SessionRouter is a thin delegation wrapper — all 6 public methods are 1-line delegates to SessionStore. The class adds value only in getChannelContext() (10 lines of logic). This is appropriate for a core contract (DI boundary), but the class could be considered over-abstraction if SessionStore is always the direct implementation.","fix":"No fix needed. The thin wrapper pattern is justified: it provides a stable API surface while allowing SessionStore implementations to vary (Redis vs in-memory vs PG). getChannelContext() adds meaningful logic."}
{"ts":"0208C39","from":"quality","type":"test-result","pkg":"core","tests":330,"pass":330,"fail":0,"coverage":"99.69% stmt, 95.2% branch, 100% func, 99.69% lines (global). Orchestrator: 98.67% stmt, 92.85% branch, 100% func (dev-core reported)"}
{"ts":"0208C39","from":"quality","type":"done","task":"QA-015-PROACTIVE","out":"packages/core/src/orchestrator/{types,react-loop,session-router,index}.ts (4 src files), packages/core/tests/orchestrator/{types,react-loop,session-router}.test.ts (3 test files)","note":"QA-015-PROACTIVE COMPLETE. Proactive Phase B code review for CORE-006 (orchestrator module). RESULTS: 0 CRITICAL, 0 HIGH, 4 MEDIUM (plan-code drift), 3 LOW. ALL CONSTITUTION gates PASS: (1) Rule 8 TDD — test commit 588db3d (03:56:13) precedes src commit dd7b8b4 (03:57:41), delta +1m28s, (2) Rule 9 — no cross-package imports, only relative paths within core/ + zod, (3) Rule 10 — 330 tests pass, Biome clean, tsc clean, coverage 99.69% stmt / 95.2% branch (above 90% target), (4) Rule 14 — max file 269 lines (react-loop.ts), well under 400. Plan §4.6 + ADR-014/020/021 implemented with justified deviations: LlmProvider narrowed to chat-only DI contract, SessionRouter refactored as class wrapping SessionStore DI interface, switchChannel() absorbed into resolve(). ReAct loop correctly implements AsyncGenerator with ADR-020 error recovery (retryable ProviderError backoff, ToolError→LLM recovery, total timeout, max iterations). Overall: EXCELLENT quality. 4 MEDIUM items are all plan-code drift requiring PLAN_SYNC update, not code fixes."}
{"ts":"0208C39","from":"quality","type":"coverage-report","core":"99.69% stmts / 95.2% branch / 100% funcs / 99.69% lines","infra":"N/A (not started)","channels":"N/A (not started)","gateway":"N/A (not started)"}
{"ts":"0208C39","from":"quality","type":"done","task":"QA-013","out":"PHASE B COMPLETE REVIEW SUMMARY — all 6 CORE modules reviewed","note":"Phase B Quality Review COMPLETE. Smoke test (main branch, quality worktree): 241 tests PASS, typecheck PASS, lint PASS (624ms). Reviewed: QA-012 (CORE-001+002+005, 2M 3L), QA-013 (CORE-003, 3M 3L), QA-014-PROACTIVE (CORE-004, 2M 1L), QA-015-PROACTIVE (CORE-006, 4M 3L). Total: 0 CRITICAL, 0 HIGH, 11 MEDIUM, 10 LOW across 25 src + 22 test files. ALL CONSTITUTION gates PASS for all 6 modules. TDD compliance verified for all 6 CORE tasks. All MEDIUM issues are plan-code drift — Architect PLAN_SYNC update needed. No code fixes blocking. Ready for Phase B merge and Phase C transition."}
{"ts":"0208C41","from":"quality","type":"done","task":"QA-013","out":"PHASE B FINAL VERIFICATION — 330 tests smoke test on post-merge main (CORE-004+CORE-006 merged)","note":"QA-013 FINAL VERIFICATION after CORE-004+CORE-006 merge to main. Smoke test (quality worktree, rebased on main): 330 tests PASS (28 test files, 724ms), typecheck PASS (tsc -b --noEmit), lint PASS (81 files, 17ms). Coverage (dev-core reported): 99.69% stmt, 95.2% branch, 100% func, 99.69% lines — ABOVE 90% core target. TDD compliance re-verified for all 6 CORE tasks (CORE-001: test 02:50:48→src 02:52:07 Δ+1m19s, CORE-002: test 03:01:50→src 03:03:37 Δ+1m47s, CORE-003: test 03:31:05→src 03:33:08 Δ+2m03s, CORE-004: test 03:45:04→src 03:46:36 Δ+1m32s, CORE-005: test 03:05:25→src 03:06:25 Δ+1m00s, CORE-006: test 03:56:13→src 03:57:41 Δ+1m28s). Rule 9 package boundary: 0 cross-package imports. Rule 14 file size: max 269 lines (react-loop.ts), all under 400. CONSTITUTION gates: ALL PASS. Phase B code sprint quality: EXCELLENT. 11 MEDIUM issues (all plan-code drift for PLAN_SYNC), 10 LOW (informational). No blocking issues. READY FOR PHASE B CLOSURE."}
{"ts":"0208C41","from":"quality","type":"coverage-report","core":"99.69% stmts / 95.2% branch / 100% funcs / 99.69% lines","infra":"N/A (not started)","channels":"N/A (not started)","gateway":"N/A (not started)"}
{"ts":"0208C44","from":"quality","type":"claim","task":"QA-016","note":"Phase C INFRA code review started. Scope: db (6 adapters), cache (2 modules), embedding (1 service), llm (2 providers), mcp (1 registry), common (1 circuit breaker). 18 src files, 14 test files."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"HIGH","ref":"packages/infra/tests/mcp/tool-registry.test.ts:2","desc":"Test suite FAILS: 'Cannot find package zod' — zod ^4.3.6 declared in packages/infra/package.json but not resolvable at runtime. 16 MCP tests unable to execute. CONSTITUTION §10 violation: 'All tests pass' not met.","fix":"Run 'pnpm install' to resolve zod dependency in infra workspace. Verify with 'pnpm vitest run --project infra'."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"HIGH","ref":"packages/infra/src/cache/redis-working-memory.ts:73,89,123,137,148,178,185,195","desc":"8 bare catch blocks silently swallow errors without ANY logging. Redis failures are invisible — no metrics, no logs, no alerts. Debugging Redis degradation requires inspecting redisState which has no external visibility.","fix":"(1) Add structured logging (logger.warn) to each catch block with operation name and error. (2) Add a public getter for circuit state (isRedisAvailable). (3) Consider emitting events/metrics on Redis fallback activation."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/llm/google-provider.ts:51","desc":"Module-level mutable state: 'let toolCallCounter = 0'. This is a global counter that persists across all GoogleLlmProvider instances and is never reset. In long-running server, this will grow unbounded. More critically, it makes the module non-deterministic and difficult to test in parallel.","fix":"Move toolCallCounter inside the class as an instance field, or use crypto.randomUUID() for callId generation (consistent with PgSessionStore pattern)."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/cache/redis-working-memory.ts:26-30,232-237","desc":"RedisWorkingMemory implements a hand-rolled circuit breaker (redisState) instead of reusing the common/circuit-breaker.ts CircuitBreaker class. Duplicated pattern: failure counting, open state, threshold=5. Missing: cooldown period (once open, never recovers), half_open probe state.","fix":"Replace hand-rolled circuit breaker with CircuitBreaker from common/circuit-breaker.ts. This adds cooldown recovery and half_open probing, matching ADR-021."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/db/pg-semantic-memory.ts:92-123","desc":"decay() method reads ALL memory importances (SELECT importance FROM memories) into JS memory before deleting. For large datasets (100K+ memories), this loads all values unnecessarily. The statistics could be computed in SQL directly.","fix":"Use a single SQL query: 'WITH deleted AS (DELETE FROM memories WHERE importance < $1 RETURNING importance), stats AS (SELECT count(*) as total, min(importance), max(importance), avg(importance) FROM memories) SELECT * FROM deleted, stats'."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/embedding/index.ts:1","desc":"Relative import path '../..core/src/types/health.js' uses different depth (../../) vs other files (../../../). This is because embedding/index.ts is the main module file. Inconsistency in package layout: embedding has logic in index.ts while other modules (db, cache, llm, mcp) separate index.ts as barrel.","fix":"Move GeminiEmbeddingService implementation to embedding/gemini-embedding.ts and make index.ts a barrel export (consistent with other modules)."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"CONSTITUTION §9","desc":"INFRA imports from core/src/memory/types.js (M0-M5 interfaces) and core/src/orchestrator/types.js (LlmProvider, ToolExecutor, SessionStore). CONSTITUTION §9 literally states infra may import 'packages/core/src/types/ only'. However, PLAN_SYNC B.7 explicitly lists these as approved cross-package interfaces, and DEVOPS-004 configured subpath exports. This is a §9 text vs intent gap.","fix":"Architect should update CONSTITUTION §9 table: infra → '@axel/core/types, @axel/core/memory, @axel/core/orchestrator' (reflecting actual approved imports). Or alternatively use barrel re-exports from core/types/."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/mcp/tool-registry.ts:239-244","desc":"validatePath() does not resolve symlinks before boundary check. An attacker could create a symlink inside basePath that points outside, bypassing the check. path.resolve() only normalizes path segments, not symlinks.","fix":"Use fs.realpathSync() or fs.realpath() after path.resolve() to resolve symlinks before checking the boundary. Note: this requires async/fs import."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"MEDIUM","ref":"packages/infra/src/db/pg-episodic-memory.ts:83","desc":"searchByTopic() uses ILIKE '%' || $1 || '%' which is vulnerable to SQL wildcard injection. User input containing '%' or '_' characters would produce unexpected matching behavior.","fix":"Escape special SQL LIKE characters in the topic parameter before passing to query, or use ts_query/websearch_to_tsquery for proper text search."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"LOW","ref":"packages/infra/src/mcp/tool-registry.ts:37-69","desc":"zodToJsonSchema() is a simplified implementation that only handles basic Zod types (string, number, boolean, array, object, enum). Nested objects, unions, intersections, and literal types are not supported. For production, consider using zod-to-json-schema npm package.","fix":"Replace with zod-to-json-schema library for comprehensive schema conversion, or document the limitation explicitly."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"LOW","ref":"packages/infra/src/cache/redis-working-memory.ts:130-151","desc":"compress() concatenates all turns with simple string concatenation. This is a placeholder — real compression should use LLM summarization. Acceptable for initial implementation.","fix":"Document as TODO: replace with LLM-based summarization in production."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"LOW","ref":"packages/infra/src/db/pg-session-store.ts:100-125","desc":"getStats() query is overly complex with LATERAL JOIN + jsonb_object_agg + subquery. avg_response_time_ms hardcoded to 0, tools_used hardcoded to empty array. The complex query returns mostly static values.","fix":"Simplify: return turn_count from sessions table + basic channel_breakdown. Defer response time tracking to a separate metrics system."}
{"ts":"0208C44","from":"quality","type":"issue","sev":"LOW","ref":"packages/infra/src/**/*.ts","desc":"All infra src files use relative path imports (../../../core/src/...) instead of @axel/core/* subpath exports. DEVOPS-004 configured these exports, but infra code doesn't use them. Relative paths are fragile and break on file moves.","fix":"Migrate imports to use @axel/core/types, @axel/core/memory, @axel/core/orchestrator subpath exports."}
{"ts":"0208C44","from":"quality","type":"test-result","pkg":"global","tests":459,"pass":459,"fail":0,"suites_pass":40,"suites_fail":1,"note":"tool-registry.test.ts fails (zod resolve). 459/475 tests run (16 MCP tests skipped due to zod). Biome: 0 errors, 114 warnings. tsc: clean (0 errors)."}
{"ts":"0208C44","from":"quality","type":"coverage-report","core":"99.69%","infra":"95%+ (dev-infra reported: cache 91.44%, common 100%, db 95.5%, embedding 99.2%, llm 95.89%, mcp 92.12%)","channels":"—","gateway":"—","note":"Infra coverage reported by dev-infra C44; QA unable to independently verify due to zod resolve failure affecting MCP module. All reported modules exceed 80% target."}
{"ts":"0208C44","from":"quality","type":"done","task":"QA-016","out":"packages/infra/src/ (18 files), packages/infra/tests/ (14 files)","note":"Phase C code review complete. 2 HIGH, 7 MEDIUM, 4 LOW issues found. HIGH: (1) zod dep resolve failure — 16 tests cant run, CONSTITUTION §10 violation; (2) 8 bare catch blocks in redis-working-memory — silent error swallowing. MEDIUM: global mutable state, circuit breaker duplication, decay() memory inefficiency, embedding index layout, §9 text gap, symlink traversal in validatePath, SQL wildcard injection. Test gate: CONDITIONAL PASS (459/475 tests pass, tsc+biome clean, zod fix needed). TDD: PASS. File size: PASS."}
