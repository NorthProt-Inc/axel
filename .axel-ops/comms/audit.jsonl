{"ts":"0208C45","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-055","location":"packages/infra/src/mcp/tool-registry.ts:179-189","current":"Command allowlist only checks when call.toolName === 'execute_command'. Any other tool can pass command-like args without allowlist check.","expected":"ADR-010 specifies allowlist enforcement for all command execution. Current implementation only guards the specific tool named 'execute_command'. If a tool has a different name but executes commands, it bypasses the allowlist.","evidence":"ADR-010:43 'config.security.commandAllowlist.includes(command)'. Code at tool-registry.ts:179 checks 'call.toolName === \"execute_command\"'. This is a weak enforcement — relies on tool naming convention rather than structural security."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-056","location":"packages/infra/src/llm/anthropic-provider.ts:174-179","current":"handleBlockStop: JSON.parse failure on tool call args silently falls through with empty args {}. No logging or error event.","expected":"Silent failure on tool call JSON parsing could cause tools to execute with missing arguments. Should at minimum log a warning or yield an error event. Tool may produce unexpected results with empty args.","evidence":"anthropic-provider.ts:176 catch block is empty (just passes {} as args). ADR-020 defines error taxonomy including ToolError. Silently swallowing parse errors contradicts ADR-020 principle of explicit error handling."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-057","location":"packages/infra/src/db/pg-semantic-memory.ts:92-123","current":"decay() method fetches ALL memories (SELECT importance FROM memories) into memory, then deletes below threshold. No batch processing, no actual decay calculation.","expected":"ADR-015 defines 8-step decay formula. Plan §3.2 (lines 1010-1085) specifies adaptive decay with recency, access stability, channel diversity factors. PgSemanticMemory.decay() only does threshold-based DELETE — it does not apply the decay formula at all.","evidence":"core/decay/calculator.ts implements the full 8-step formula. But PgSemanticMemory.decay() ignores it — just reads importance and deletes below threshold. The DecayRunConfig only has { threshold: number }, not the full DecayConfig from core/decay/types.ts. The actual decay calculation (updating decayed_importance) is never called from PG adapter."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-058","location":"docs/adr/002-postgresql-single-db.md:23","current":"PostgreSQL 16 + pgvector 0.8","expected":"docker-compose.dev.yml and PLAN_SYNC both specify PostgreSQL 17 + pgvector. ADR-002 still says PostgreSQL 16 + pgvector 0.8.","evidence":"PLAN_SYNC A.1: 'docker-compose.dev.yml | IN_SYNC | PostgreSQL 17 + pgvector + Redis 7'. ADR-002:23 says 'PostgreSQL 16 + pgvector 0.8'. Version mismatch between ADR and actual infrastructure."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-059","location":"packages/infra/src/cache/redis-working-memory.ts:117-128","current":"getSummary() returns null on PG fallback path (line 127: return null). Working memory summary is only available from Redis cache.","expected":"ADR-003: 'PG-first write pattern: PG is source of truth, Redis is read cache'. But getSummary has no PG fallback — if Redis is down or summary is not cached, null is returned even if turns exist in PG.","evidence":"ADR-003 degradation table: 'Working Memory read | PG direct read'. getSummary does not query PG at all on the fallback path (line 127). compress() which creates the summary also only writes to Redis (line 147). Summary data has no PG backing — violates ADR-003 principle that Redis data has PG shadow."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"LOW","id":"AUD-060","location":"packages/infra/src/db/pg-pool.ts:1","current":"import type { ComponentHealth } from '../../../core/src/types/health.js' — uses relative path ../../../core/src/types/","expected":"packages/infra/package.json has @axel/core as workspace dependency. Should use '@axel/core/types' import path (enabled by DEVOPS-004 subpath exports) instead of fragile relative paths.","evidence":"DEVOPS-004 (done C44) added subpath exports: @axel/core/{types,memory,decay,context,persona,orchestrator}. All infra src files still use relative '../../../core/src/...' paths. While functional, this is fragile and doesn't use the intended package boundary mechanism."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"LOW","id":"AUD-061","location":"packages/infra/src/mcp/tool-registry.ts:79","current":"defineTool returns ToolDefinition & { __handler, __schema } — internal properties with __ prefix leaked into public API","expected":"Internal handler/schema should not be part of the return type. __handler and __schema are implementation details that pollute the ToolDefinition interface.","evidence":"tool-registry.ts:79 return type includes __handler and __schema. These are consumed by ToolRegistry.register() (line 103) but are exposed to all callers of defineTool(). Considered design smell but not a bug — LOW severity."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"LOW","id":"AUD-062","location":"packages/infra/src/cache/redis-working-memory.ts:130-151","current":"compress() uses try/catch with empty catch blocks. If redis.lrange fails at line 135, function silently returns without compressing.","expected":"Error handling should at minimum log the failure. ADR-003 specifies 'logger.warn' pattern for Redis failures.","evidence":"ADR-003 code examples show explicit logger.warn() calls on Redis failures. Actual code has bare catch blocks (lines 137,150). Non-critical but inconsistent with ADR-003 specification."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"LOW","id":"AUD-063","location":"packages/infra/src/db/pg-episodic-memory.ts:59","current":"addMessage() increments turn_count via separate UPDATE query. No transaction wrapping the INSERT + UPDATE.","expected":"INSERT message + UPDATE turn_count should be atomic (single transaction). If UPDATE fails after INSERT succeeds, turn_count will be incorrect. Could use a PG trigger or CTE instead.","evidence":"No explicit transaction handling in any PG adapter methods. PG pool wrapper (pg-pool.ts) does not expose transaction API. All multi-statement operations are non-atomic. LOW severity because turn_count is a convenience counter, not critical data."}
{"ts":"0208C45","from":"audit","type":"finding","severity":"LOW","id":"AUD-064","location":"packages/infra/src/common/circuit-breaker.ts:39-41","current":"CircuitBreaker constructor uses Partial<CircuitBreakerConfig> spread. If only some fields provided, defaults fill in.","expected":"ADR-021 specifies failureThreshold=5, cooldownMs=60_000, halfOpenMaxProbes=1. Code defaults (line 19-23) match: failureThreshold=5, cooldownMs=60_000, halfOpenMaxProbes=1. PASS — no issue. But halfOpenMaxProbes is defined but never enforced in the state machine logic.","evidence":"CircuitBreaker.execute() allows any number of calls in half_open state (no probe counter). config.halfOpenMaxProbes is declared but unused. First success in half_open resets to closed regardless of probe count. ADR-021 says 'HALF_OPEN (1 probe)' but code doesn't enforce the limit."}
{"ts":"0208C45","from":"audit","type":"done","task":"AUDIT-003","findings_critical":0,"findings_high":6,"findings_medium":8,"findings_low":5,"note":"AUDIT-003: Phase C code audit (INFRA-001~005, COMMON-CB). 19 findings total. === HIGH (6): AUD-046/047 — CONSTITUTION §9 package boundary violation (infra imports from core/memory/types.js and core/orchestrator/types.js, not from core/src/types/ as §9 requires). AUD-048 — global mutable state in google-provider.ts (toolCallCounter). AUD-049 — ADR-003 circuit breaker spec not followed (ad-hoc boolean vs CircuitBreaker class). AUD-050 — plan-code schema mismatch (sessions table user_id/channel_history missing from plan, SYNC-004 stalled). AUD-051 — userId used as session_id in redis-working-memory pushTurn (FK violation risk). === MEDIUM (8): AUD-052 — naming convention break (embedding impl in index.ts). AUD-053 — ILIKE may not use trigram index. AUD-054 — validatePath doesn't resolve symlinks (security rule violation). AUD-055 — command allowlist weak enforcement. AUD-056 — silent JSON parse failure in anthropic tool calls. AUD-057 — decay() doesn't apply ADR-015 formula. AUD-058 — ADR-002 says PG 16 but infra uses PG 17. AUD-059 — getSummary has no PG fallback (violates ADR-003). === LOW (5): AUD-060 — relative imports instead of @axel/core subpath exports. AUD-061 — __handler/__schema leaked in defineTool return type. AUD-062 — empty catch blocks missing logger.warn per ADR-003. AUD-063 — non-atomic INSERT+UPDATE in addMessage. AUD-064 — halfOpenMaxProbes config declared but never enforced. === TDD: PASS (100% — all 13 non-barrel src files had test-first commits). File size: PASS (max 257 lines, limit 400). No circular deps found. No dead code detected."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"HIGH","id":"AUD-065","location":"packages/gateway/src/server.ts:186","current":"WS auth uses query parameter token (/ws?token=<token>). Token appears in URL.","expected":"ADR-019 Section 3 specifies first-message auth pattern (WsAuthMessage {type:'auth',token:string}). Code uses query parameter instead. Token in URL is logged by proxies, appears in browser history, Referer headers.","evidence":"ADR-019:62-89 defines first-message WS auth with 5s timeout. websocket-protocol.md:22-28 also specifies query parameter auth. Contradiction: ADR-019 says first-message, websocket-protocol.md says query param. Gateway implements query param. ADR-019 Alternatives table (line 209) explicitly lists query parameter as rejected alternative due to 'URL에 토큰 노출 (로그, Referer)'."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"HIGH","id":"AUD-066","location":"packages/gateway/src/server.ts:12","current":"GatewayConfig has rateLimitPerMinute field but NO rate limiting is implemented anywhere in server.ts","expected":"Plan L9 (line 1572): 'Security middleware (auth, rate limit, CORS)'. OpenAPI spec (openapi-v1.yaml:1062): 'Rate limit exceeded (30 req/min default)'. ADR-019 endpoint matrix implies rate limiting. No rate limit logic exists in code — unlimited requests accepted.","evidence":"server.ts:12 defines rateLimitPerMinute in config but never references it in any handler. Grep for 'rateLimit' in server.ts shows only the config field declaration at line 12. No middleware, no counter, no 429 response. Plan:327 container shows 'rateLimiter: new RedisRateLimiter(redis, circuitBreaker)' — this service is not created or used in gateway code."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"HIGH","id":"AUD-067","location":"packages/gateway/src/server.ts:104-107","current":"Request body has no size limit. body string accumulates all data chunks without upper bound.","expected":"Missing request body size limit allows memory exhaustion DoS. Any authenticated client can send arbitrarily large request bodies. Plan spec (openapi-v1.yaml:640) specifies content maxLength 32000 chars. No enforcement exists.","evidence":"server.ts:104-107 accumulates req data chunks into unbounded string variable body. No Content-Length check, no byte counter, no stream abort. OpenAPI spec defines content maxLength: 32000 but gateway doesn't validate against it. Standard practice: limit body to ~1MB and reject larger payloads."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-068","location":"packages/gateway/src/server.ts:145-162","current":"CORS allows any origin in corsOrigins list. OPTIONS preflight returns 204 without auth. Non-OPTIONS responses also set CORS headers if origin matches. But CORS headers are NOT set when origin is not in the list — this means credentials (cookies) won't be sent, but CORS headers absence doesn't block simple requests.","expected":"CORS implementation is functionally correct for API protection. However, Access-Control-Allow-Credentials is not set, which means cookies/auth tokens won't be included in cross-origin requests from browsers. This is correct for Bearer token auth but should be explicitly documented. PASS with note.","evidence":"server.ts:145-162 CORS impl. No Vary: Origin header set (minor — may cause cache poisoning in CDN scenarios). No Access-Control-Allow-Credentials (correct for Bearer auth, not cookie-based). Functionally sound but missing Vary: Origin header."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-069","location":"packages/gateway/src/server.ts:359-364","current":"timingSafeEqual returns false immediately when lengths differ, before doing constant-time comparison. This leaks token length via timing side-channel.","expected":"crypto.timingSafeEqual requires equal-length buffers. The early return on length mismatch is a known pattern, but leaks that the token length is wrong. Ideal: pad shorter string to match longer string length, then compare. Or always hash both with HMAC before comparing.","evidence":"server.ts:360 'if (a.length !== b.length) return false' — returns immediately. Attacker can determine correct token length by measuring response times for different-length tokens. For static bearer tokens this is a minor concern (attacker still needs to brute-force the content), but reduces security margin."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-070","location":"packages/gateway/src/server.ts:134-142","current":"500 error handler exposes err.message in development mode: config.env === 'development' ? message : 'Internal Server Error'. message comes from err.message which could contain internal paths, DB connection strings, etc.","expected":"ADR-011 ENV-aware error handling specifies: development mode returns {error, detail, stack, requestId}. Production returns {error, requestId}. Current code partially implements this (no stack trace in development, no detail field). Also, the error classification (classifyError()) from ADR-011 is not implemented — raw err.message is used instead of classified publicMessage.","evidence":"ADR-011:47-66 code example shows classifyError(err) → {status, publicMessage, internalMessage, stack}. Gateway code at line 135 uses raw err.message directly. No error classification, no structured error taxonomy per ADR-020. Partial ADR-011 implementation."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-071","location":"packages/channels/src/telegram/telegram-channel.ts vs plan:1512-1515","current":"TelegramChannel does not implement onDisconnect/onReconnect handlers. Plan specifies reconnection lifecycle with exponential backoff + circuit breaker for all channels.","expected":"Plan L8 (line 1512-1515): 'Reconnection lifecycle (ERR-042 해소) — 채널 연결이 끊어진 경우 자동 재연결 시도. 구현체는 지수 백오프 + circuit breaker 패턴.' DiscordChannel implements onDisconnect/onReconnect. TelegramChannel does not. AxelChannel interface marks these as optional (?), so no type error, but plan intention is all channels should have reconnection.","evidence":"core/types/channel.ts:81-82 defines onDisconnect?/onReconnect? as optional. DiscordChannel (discord-channel.ts:126-131) implements both. TelegramChannel has neither. grammy Bot has built-in reconnection, so external reconnection handlers may be less critical, but plan spec requires them."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-072","location":"packages/gateway/src/server.ts:1-365 vs plan:1577-1597","current":"Gateway implements 4 routes: /health, /health/detailed, /api/v1/chat, /api/v1/chat/stream. Plan L9 specifies 12 routes.","expected":"Plan L9 lists: /health, /health/detailed, /api/v1/chat, /api/v1/chat/stream, /api/v1/memory/search, /api/v1/memory/stats, /api/v1/session/end, /api/v1/tools, /api/v1/tools/execute, /ws, /webhooks/telegram, /webhooks/discord. Gateway only implements 4 HTTP routes + /ws. 8 routes missing. Acceptable as stub implementation, but PLAN_SYNC should mark these as NOT_STARTED.","evidence":"openapi-v1.yaml defines all 12+ routes with full request/response schemas. server.ts:38-43 only registers 4 routes. EDGE-005 BACKLOG description says 'Routes per openapi-v1.yaml: /health, /api/v1/chat, /api/v1/memory/search, /api/v1/session, /ws' — some assigned routes are missing from implementation."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-073","location":"apps/axel/src/container.ts:1-2,11-12 vs CONSTITUTION §9","current":"apps/axel/src/container.ts imports from @axel/core/context, @axel/core/memory, @axel/core/orchestrator, @axel/core/types, @axel/infra — 5 different package paths.","expected":"CONSTITUTION §9: apps/axel/ may import from 'Any packages/*'. This is PASS — apps/ has no import restrictions. However, container.ts imports ContextAssembler and SessionRouter as concrete classes from core (not just types). This means apps/axel/ depends on core implementation details, not just interfaces.","evidence":"CONSTITUTION §9 table: 'apps/axel/ | Any packages/*'. Import analysis: all @axel/* imports are within allowed scope. No violation. But design note: concrete class imports (ContextAssembler, SessionRouter) tightly couple apps/ to core/ implementations."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"LOW","id":"AUD-074","location":"apps/axel/src/main.ts:47-48","current":"gracefulShutdown is called with channels: [] (empty array). No channels are passed to the shutdown handler.","expected":"ADR-021 Section 2 Phase 1: 'Stop channels — channel adapters: disconnect gracefully'. main.ts:48 passes empty channels array, so no channels are stopped during shutdown. This means channel connections (Discord bot, Telegram bot) remain active after SIGTERM.","evidence":"main.ts:47-48 'channels: []' in gracefulShutdown call. The container object doesn't include channels (they aren't created in the current bootstrap flow). When channels are wired in, this needs to be updated. Current state: shutdown doesn't stop channels."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"LOW","id":"AUD-075","location":"packages/channels/src/discord/discord-channel.ts:290-302, packages/channels/src/telegram/telegram-channel.ts:216-228","current":"splitMessage function is duplicated identically in both Discord and Telegram channel files.","expected":"DRY principle. Both files contain the exact same splitMessage(content, maxLength) function. Should be extracted to a shared utility in packages/channels/src/utils/ or similar.","evidence":"discord-channel.ts:290-302 and telegram-channel.ts:216-228 are character-for-character identical implementations of splitMessage(). 13 duplicated lines."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"LOW","id":"AUD-076","location":"apps/axel/src/lifecycle.ts:23","current":"const startTime = Date.now(); — module-level mutable state. Captures time when module is first imported, not when server actually starts.","expected":"startTime should be set when the server starts (in aggregateHealth or startupHealthCheck), not at module import time. If module is imported during test setup, uptime calculation will be incorrect.","evidence":"lifecycle.ts:23 captures Date.now() at module load time. This is a module-level side effect. In tests, this means uptime includes test setup time. Minor issue but inconsistent with 'no global mutable state' principle."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"LOW","id":"AUD-077","location":"apps/axel/src/main.ts vs apps/axel/tests/","current":"main.ts has no corresponding main.test.ts. 4 source files but only 3 test files: config.test.ts, container.test.ts, lifecycle.test.ts. main.ts is untested.","expected":"CONSTITUTION §8: 'All files under packages/*/src/ MUST have a corresponding test file'. apps/axel/src/ is not under packages/ but under apps/ — §8 text may not strictly apply. However, TDD protocol was mandated for BOOTSTRAP-001. main.ts bootstrap function has testable logic (signal handlers, shutdown orchestration).","evidence":"Git log shows test(app) commit created tests for config, container, lifecycle — but not main. main.ts:17-60 contains bootstrap() with config loading, container creation, health check, and signal handler registration. The signal handler and shutdown flow are not tested."}
{"ts":"0208C53","from":"audit","type":"finding","severity":"LOW","id":"AUD-078","location":"packages/gateway/src/server.ts:35","current":"const startedAt = Date.now(); — captures time when createGatewayServer is called, not when start() resolves. Used in handleHealthDetailed for uptime calculation.","expected":"startedAt should be set in start() after the server is actually listening, not when the factory function is invoked. Minor accuracy issue in uptime reporting.","evidence":"server.ts:35 sets startedAt before httpServer is even created (line 46). If there's a delay between createGatewayServer() and start(), uptime will be inflated. Test: createGatewayServer is called in beforeEach, start() immediately after — negligible impact in practice."}
{"ts":"0208C53","from":"audit","type":"done","task":"AUDIT-004","findings_critical":0,"findings_high":3,"findings_medium":6,"findings_low":5,"note":"AUDIT-004: Phase D code audit — EDGE-003 (Discord), EDGE-004 (Telegram), EDGE-005 (Gateway), BOOTSTRAP-001 (DI). 14 findings total. === TDD: PASS (4/4 components have test-first commits: RED→GREEN order verified for Discord, Telegram, Gateway, Bootstrap). === §9 Package Boundary: PASS (channels imports from @axel/core/types only; gateway imports from @axel/core/types only; apps/axel imports from all packages — allowed per §9). === §14 File Size: PASS (max 364 lines server.ts, limit 400). === HIGH (3): AUD-065 — WS auth uses query parameter instead of ADR-019 first-message pattern (token in URL). AUD-066 — rateLimitPerMinute config field declared but NO rate limiting implemented (plan spec requires it). AUD-067 — no request body size limit (DoS vector, OpenAPI specifies maxLength 32000). === MEDIUM (6): AUD-068 — CORS missing Vary: Origin header (CDN cache poisoning risk). AUD-069 — timingSafeEqual leaks token length via early return. AUD-070 — partial ADR-011 implementation (no classifyError, no error taxonomy). AUD-071 — Telegram missing onDisconnect/onReconnect (plan ERR-042 spec). AUD-072 — 8/12 plan routes not implemented (stub acceptable but PLAN_SYNC gap). AUD-073 — concrete class imports in apps/ (design note, not violation). === LOW (5): AUD-074 — shutdown passes empty channels array. AUD-075 — splitMessage duplicated in Discord+Telegram. AUD-076 — module-level startTime (lifecycle.ts). AUD-077 — main.ts has no test file. AUD-078 — startedAt set before server start. === SECURITY SUMMARY: Gateway auth is functional (timing-safe Bearer). CORS works. Error redaction works for production (dev mode exposes err.message). WS auth functional but uses rejected pattern from ADR-019. Critical gap: no rate limiting and no body size limit. === No circular deps. No dead code (except addReaction no-op in Discord — documented). No files >400 lines."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"HIGH","id":"AUD-079","location":"packages/gateway/src/ws-handler.ts:23,37,69","current":"WebSocket messages (auth and chat) have no size limit. data.toString() on arbitrarily large payloads can cause memory exhaustion.","expected":"WS message size limit matching HTTP body limit (32KB). ws.on('message') should check data.length before JSON.parse. HTTP has MAX_BODY_BYTES=32768 (server.ts:15) but WS has no equivalent.","evidence":"server.ts:15 defines MAX_BODY_BYTES=32768 for HTTP. ws-handler.ts has no size check on data parameter. Large WS messages bypass HTTP body limit. JSON.parse on multi-MB payloads can cause OOM or CPU spike."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"HIGH","id":"AUD-080","location":"packages/gateway/src/server.ts:157-175","current":"Rate limit bucket Map grows unbounded. Empty timestamp arrays are never removed from rateLimitBuckets Map.","expected":"After removing expired timestamps, if array is empty, delete the IP key from Map. Long-running server accumulates Map entries for every unique IP that ever made a request. Memory leak.","evidence":"server.ts:168-170 removes old timestamps but line 165 rateLimitBuckets.set(clientIp, timestamps) persists empty arrays indefinitely. No periodic cleanup, no LRU eviction. Production server receiving traffic from many IPs will accumulate unbounded Map entries."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"HIGH","id":"AUD-081","location":"packages/core/src/orchestrator/inbound-handler.ts:97","current":"Catch block discards error completely (_err: unknown). No logging, no telemetry, no error type inspection. Silent failure.","expected":"ADR-020 error taxonomy requires classified error handling. ADR-011 requires environment-aware error reporting. At minimum: log error with context (userId, channelId, error message/stack) for operators. Current: error vanishes silently, making production debugging impossible.","evidence":"inbound-handler.ts:97 'catch (_err: unknown)' — underscore prefix indicates intentional discard. No console.error, no logger call, no error event emission. Only a generic Korean error message is sent to user. Compare: react-loop.ts properly yields error events for each error type (ADR-020 compliance)."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"HIGH","id":"AUD-082","location":"packages/gateway/src/server.ts:252-256, ws-handler.ts:121","current":"Gateway constructs InboundMessage without timestamp field. server.ts:252 and ws-handler.ts:121 pass {userId, channelId, content} — missing required timestamp:Date.","expected":"InboundMessage interface (core/types/channel.ts) requires timestamp: Date. inbound-handler.ts:142 uses inbound.timestamp in Message construction. Missing timestamp means undefined is passed to Message.timestamp, corrupting downstream data.","evidence":"core/types/channel.ts InboundMessage defines 'timestamp: Date' as required. server.ts:252 omits it. ws-handler.ts:121 omits it. TypeScript may not catch this if handleMessage signature is loosely typed. inbound-handler.ts:142 reads inbound.timestamp — will be undefined at runtime."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"HIGH","id":"AUD-083","location":"tools/migrate/src/cli.ts:11-12","current":"Hardcoded database credentials in fallback: 'postgresql://postgres:postgres@localhost:5432/axel_dev'","expected":"NEVER provide default credentials (security rules). CLI should fail loudly if DATABASE_URL is not set. Hardcoded postgres:postgres credentials are visible in source code, risk of accidental production connection with weak credentials.","evidence":"CLAUDE.md security rules: 'NEVER hardcode API keys, tokens, or secrets in source code'. cli.ts:11-12 uses ?? operator with hardcoded connection string containing username 'postgres' and password 'postgres'. If deployed without DATABASE_URL env var, connects to default DB with known weak credentials."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-084","location":"tools/migrate/src/migrator.ts:70,109","current":"Migration SQL files are loaded from disk and executed directly via client.query(migration.upSql) without any content validation.","expected":"While migration tools inherently execute SQL, the tool should validate against dangerous patterns (COPY TO PROGRAM, CREATE EXTENSION with untrusted languages). Migration files are part of the supply chain — compromised files execute arbitrary SQL with elevated privileges.","evidence":"migrator.ts:70 'await this.client.query(migration.upSql)' and :109 'await this.client.query(migration.downSql)'. No validation of SQL content. Transaction wrapping is correct (BEGIN/COMMIT/ROLLBACK) but does not prevent malicious SQL execution. MEDIUM because migration files are developer-authored and committed to git (supply chain trust), not user-supplied."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-085","location":"tools/migrate/src/migrator.ts:135-136","current":"Migration file paths constructed via join(migrationsDir, upFile) without symlink resolution. Path boundary check missing.","expected":"Security rules: 'Path handling: always validate with path.resolve() + boundary check, block symlink traversal'. migrator.ts uses join() without resolve() or realpath(). A symlink in migrations directory could read files outside the intended directory.","evidence":"CLAUDE.md security: 'block symlink traversal'. migrator.ts:135-136 join() does not resolve symlinks. readdir() returns filenames but symlinks in the directory are followed by readFile(). Attack vector requires filesystem write access to migrations dir. MEDIUM because migration directory is developer-controlled, not user-accessible."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-086","location":"packages/gateway/src/http-utils.ts:4-6","current":"HTTP responses lack security headers: X-Content-Type-Options, X-Frame-Options not set.","expected":"Production API gateway should include: X-Content-Type-Options: nosniff (prevent MIME sniffing), X-Frame-Options: DENY (prevent clickjacking). These are standard security hardening headers for HTTP APIs.","evidence":"http-utils.ts:5 sendJson sets only Content-Type header. No X-Content-Type-Options, no X-Frame-Options. OWASP recommendation for all HTTP responses. MEDIUM because this is an API (not browser-rendered HTML), reducing clickjacking risk, but MIME sniffing is still relevant."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-087","location":"packages/gateway/src/server.ts:157-158","current":"Rate limiting uses req.socket.remoteAddress which shows proxy IP when behind reverse proxy (nginx, Cloudflare).","expected":"Behind reverse proxy, all requests appear from same IP, making rate limiting ineffective. Should support X-Forwarded-For with trusted proxy configuration, or document direct-exposure requirement.","evidence":"server.ts:158 'req.socket.remoteAddress'. Standard deployment uses reverse proxy → all requests show proxy IP. rate limiting becomes per-proxy not per-client. ADR-019 does not specify proxy trust configuration. MEDIUM because single-user model (Axel) mitigates impact, but gateway is designed for multi-client access."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-088","location":"packages/infra/tests/integration/pg-redis-integration.test.ts:40-48","current":"Hardcoded fallback credentials: password 'axel_dev_password' in pgAdminConfig(), user 'axel' in config defaults.","expected":"Test should fail if env vars not set (testcontainers should provide them). Fallback to hardcoded credentials risks connecting to local dev database accidentally. Should throw if PGHOST/PGPASSWORD not set.","evidence":"pg-redis-integration.test.ts:46 'password: process.env.PGPASSWORD || \"axel_dev_password\"'. If testcontainers setup fails or is skipped, test connects to local PG with known password. Violates principle of explicit configuration. MEDIUM because this is test code, not production, but credential hygiene matters."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-089","location":"packages/infra/src/db/pg-episodic-memory.ts:1, pg-meta-memory.ts:1, cache/redis-working-memory.ts:1, cache/redis-stream-buffer.ts:1, llm/anthropic-provider.ts:1, llm/google-provider.ts:1, mcp/tool-registry.ts:3","current":"7 infra src files import from @axel/core/memory or @axel/core/orchestrator. CONSTITUTION §9 permits ONLY @axel/core/types.","expected":"§9 violation unchanged from AUDIT-003 (AUD-046/047). CONST-AMEND-001 queued but not yet approved. Reporting for completeness — these are existing violations that persist through Phase E. No new violations introduced by Phase E integration code.","evidence":"AUDIT-003 AUD-046/047. CONST-AMEND-001 in BACKLOG Queued. Infra imports @axel/core/memory (4 files) and @axel/core/orchestrator (3 files). All are type-only imports. Gateway and channels PASS §9 (gateway only imports @axel/core/types)."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-090","location":"packages/gateway/src/route-handlers.ts:80","current":"handleSessionEnd extracts sessionId via unsafe cast: (session as Record<string, unknown>).sessionId as string. No runtime validation.","expected":"Should use proper type narrowing or Zod validation. If session object shape changes or sessionId is missing, this will pass undefined to endSession, causing silent failure or runtime error. ADR-005 mandates Zod for external input validation.","evidence":"route-handlers.ts:80 double-cast pattern (as Record → .sessionId as string) bypasses TypeScript safety. If deps.getSession returns an object without sessionId property, String(undefined) = 'undefined' is passed to endSession. Should validate: typeof sessionId === 'string' && sessionId.length > 0."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"LOW","id":"AUD-091","location":"packages/gateway/src/http-utils.ts, ws-handler.ts, route-handlers.ts, types.ts","current":"4 gateway source files have no corresponding test files. Tests exist for server.ts, websocket.ts, classify-error.ts, cors-vary.ts, remaining-routes.ts, integration.ts — but http-utils.ts, ws-handler.ts, route-handlers.ts, types.ts have no dedicated test file.","expected":"CONSTITUTION §8: test file for each source file. http-utils.ts contains security-critical timingSafeEqual. ws-handler.ts contains auth logic. route-handlers.ts contains input validation. These are tested indirectly via server/websocket tests but lack isolated unit tests.","evidence":"Glob packages/gateway/tests/ shows: server.test.ts, websocket.test.ts, remaining-routes.test.ts, integration.test.ts, classify-error.test.ts, cors-vary.test.ts, setup.ts. Missing: http-utils.test.ts, ws-handler.test.ts, route-handlers.test.ts, types.test.ts. LOW because §8 text says 'packages/*/src/' and functions are tested indirectly."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"LOW","id":"AUD-092","location":"tools/migrate/src/cli.ts","current":"cli.ts has no corresponding test file. tools/migrate/tests/ only has migrator.test.ts.","expected":"CLI entry point with command routing, argument parsing, and error handling should have unit tests. Currently untested: 'up' without version (upAll path), 'down' without version (error path), 'status' output format, unknown command handling.","evidence":"Glob tools/migrate/tests/ shows only migrator.test.ts. No cli.test.ts. cli.ts has 5 distinct code paths (up+version, up all, down, status, default) — none tested directly. LOW because CLI is a thin wrapper around Migrator which is tested."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"LOW","id":"AUD-093","location":"packages/core/src/orchestrator/inbound-handler.ts:82","current":"reactLoop called with tools: [] (empty array). No tools are passed to the LLM, making tool execution impossible.","expected":"InboundHandler should receive tool definitions from ToolRegistry (via DI) and pass them to reactLoop. Plan L7 (line 1396-1401): 'tools: ToolDefinition[] — available tools for the loop'. Currently hardcoded empty array means Axel cannot use any tools in conversation. Likely a Phase E placeholder to be wired in INTEG-005.","evidence":"inbound-handler.ts:82 'tools: []'. InboundHandlerDeps includes toolExecutor but no toolRegistry or tools list. The tools are available for execution (toolExecutor) but never offered to the LLM (empty tools array). This means the LLM will never generate tool_call events. Expected to be resolved in INTEG-005 or follow-up task."}
{"ts":"0208C58","from":"audit","type":"finding","severity":"LOW","id":"AUD-094","location":"packages/gateway/src/server.ts:21","current":"startedAt = Date.now() set when createGatewayServer() is called, not when start() resolves. Uptime reported by /health/detailed may be inflated.","expected":"startedAt should be set inside start() after httpServer.listen() callback. Currently captures factory invocation time, not actual server start time. Minor accuracy issue. Carried over from AUDIT-004 AUD-078 — not yet fixed.","evidence":"AUDIT-004 AUD-078. server.ts:21 'const startedAt = Date.now()' in createGatewayServer scope. server.ts:226 uses startedAt for uptime calculation. Difference between factory call and listen() is typically <100ms. LOW impact."}
{"ts":"0208C58","from":"audit","type":"done","task":"AUDIT-005","findings_critical":0,"findings_high":5,"findings_medium":7,"findings_low":4,"note":"AUDIT-005: Phase E integration security audit (INTEG-001~006, FIX-GATEWAY-001). 16 new findings (AUD-079~094). === RESOLVED FROM AUDIT-004: AUD-065 WS auth FIXED (first-message pattern implemented in ws-handler.ts), AUD-066 rate limiting FIXED (sliding window in server.ts:157-175), AUD-067 body size limit FIXED (32KB in server.ts:15,110-119), AUD-068 CORS Vary FIXED (server.ts:184), AUD-072 missing routes FIXED (6 routes added in route-handlers.ts via INTEG-004). AUD-075 splitMessage FIXED (extracted to channels/src/utils/split-message.ts via FIX-MEDIUM-001). === HIGH (5): AUD-079 WS message size limit missing (DoS vector). AUD-080 rate limit bucket memory leak. AUD-081 silent error discard in InboundHandler (no logging). AUD-082 missing timestamp in gateway→InboundMessage construction. AUD-083 hardcoded DB credentials in migrate CLI. === MEDIUM (7): AUD-084 migration SQL unvalidated execution. AUD-085 migration file path no symlink check. AUD-086 missing security headers. AUD-087 rate limit proxy-unaware. AUD-088 test hardcoded credentials. AUD-089 §9 boundary violations persisting (CONST-AMEND-001 pending). AUD-090 unsafe cast in handleSessionEnd. === LOW (4): AUD-091 4 gateway files missing dedicated test. AUD-092 cli.ts no test. AUD-093 tools:[] empty in InboundHandler. AUD-094 startedAt timing (AUD-078 recurrence). === TDD: 6 violations found (4 gateway utilities, 1 app entry point, 1 tool CLI) — all are indirect-tested via integration tests but lack dedicated unit test files. === §9 PACKAGE BOUNDARY: PASS for Phase E new code (gateway imports @axel/core/types only, channels imports @axel/core/types only). Infra §9 violations persist unchanged from AUDIT-003. === §14 FILE SIZE: PASS (max 321 lines server.ts, limit 400). === DEAD CODE: PASS (0 unused imports, 0 commented-out blocks, 0 unreachable code). === SECURITY SUMMARY: FIX-GATEWAY-001 resolved 3 critical gaps (WS auth, rate limit, body size). Gateway auth flow is correct (timing-safe Bearer HTTP, first-message WS per ADR-019). Error redaction works (classifyError). New concerns: WS has no message size limit, rate limit has memory leak, InboundHandler silently drops errors, gateway sends InboundMessage without required timestamp."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"HIGH","id":"AUD-095","location":"broadcast.jsonl activation history C28-C88","current":"전체 549 division-cycles (9 divisions × 61 cycles) 중 활성 112, 유휴 437. 전체 Division 유휴율 79.6%. 완전 유휴 사이클(all-idle) 8회: C55, C63, C66, C70-73, C77-78. C70-C73은 4 연속 사이클 완전 유휴 — CTO가 매 사이클 Opus 4.6으로 실행되었으나 'Roadmap exhausted. Awaiting next direction from Mark' 반복.","expected":"CTO(Coordinator)는 매 사이클 Opus 4.6으로 실행됨. all-idle 사이클에서도 동일한 API 비용 발생. 8 사이클 × Opus 4.6 CTO 호출 = 순수 낭비. cycle.sh에 idle detection (BACKLOG 비어있고 에러 0 → 자동 스킵) 메커니즘 부재.","evidence":"broadcast.jsonl: C70 'All Divisions idle. All executable work complete.', C71 'All Divisions idle. Roadmap exhausted.', C72 동일, C73 동일. 4회 연속 동일 메시지. CTO가 상태 파일 읽기+확인+동일 메시지 쓰기를 반복. METRICS.md bottleneck indicators all green during these cycles."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"HIGH","id":"AUD-096","location":".axel-ops/CONSTITUTION.md §12, broadcast.jsonl C74-C77","current":"Architect Division이 5회 CTO override 당함 (C46 SYNC-004 3 cycles stalled, C51 PLAN-AMEND-001 3 cycles stalled, C55 SYNC-006 2 cycles, C60 FIX-SCHEMA-001 2 cycles, C77 FIX-MIGRATION-002 3 cycles). 조직 내 체계적 병목. 다른 Division은 0 stall.","expected":"Architect는 METRICS.md에서 유일하게 'Avg Cycle Time: 2.5 cycles', 'Stalls: 5 (CTO override)' 기록. 27개 태스크를 완료했지만, stall 패턴이 반복적으로 다른 Division의 activation을 지연시킴 (예: C44 quality+arch 대기, C50 dev-edge 대기, C55 phase transition 지연).","evidence":"METRICS.md: arch 'Avg Cycle Time: 2.5 cycles, Stalls: 5'. broadcast.jsonl C50 note: 'If PLAN-AMEND-001 not done by C51, CTO override.' C45 note: 'SYNC-004 CTO override at C46 if incomplete.' C76 note: 'If arch does not report done by C77, CTO override.' 동일 패턴 5회 반복."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"HIGH","id":"AUD-097","location":"BACKLOG.md Done table, broadcast.jsonl activation history","current":"Dev-Core Division: 마지막 활성 C61 (FIX-AUDIT-E-002), 현재 유휴 27 사이클. 9 tasks/13 active cycles = 0.69 tasks/cycle. CORE-001~006 완료 후 FIX-AUDIT-E-002 단건만 추가 실행. 330 core tests 이후 변경 없음. RES-007이 InboundHandler에서 pushTurn/addMessage 미호출 ROOT CAUSE를 발견했으나, dev-core가 수정하지 않고 유휴 상태.","expected":"RES-007 findings (CLI 기억 상실)는 packages/core/src/orchestrator/inbound-handler.ts의 버그. dev-core 소유 파일. C87에 ROOT CAUSE 발견됐으나 C88에 dev-core 미활성화. BACKLOG에 수정 태스크 미생성.","evidence":"RES-007 output: 'ROOT CAUSE: InboundHandler에서 pushTurn/addMessage 미호출, gracefulShutdown flush(*) 버그, M2/M3 영구 저장 경로 누락'. BACKLOG.md에 해당 FIX 태스크 없음. dev-core는 이 파일의 소유자 (CONSTITUTION §1: packages/core/ → dev-core)."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"HIGH","id":"AUD-098","location":"CONSTITUTION.md §1 Division table, BACKLOG.md Done, activation history","current":"10개 Division (coord 포함)이 각각 전용 worktree + opus/sonnet 모델을 사용. 총 11 worktree (main + 10 division branches). 그러나 동시 활성 최대 3-4개 division. C28-C88 동안 평균 활성 division = 112/61 = 1.84개/cycle.","expected":"10 Division 조직 구조의 오버헤드: (1) 매 cycle마다 git rebase/merge 필요, (2) 각 Division 프롬프트 로딩에 Opus 4.6 컨텍스트 비용, (3) CTO가 10개 comms 파일을 매 cycle 읽어야 함, (4) cycle.sh Phase 3에서 최대 10개 branch merge 필요. 평균 1.84 division 활성인데 10 division 인프라를 유지하는 것은 과잉 설계.","evidence":"cycle.sh: 10 worktree 경로 정의 (lines 32-46), get_active_divisions() 호출 (line 178), Phase 3 merge loop (lines 233-286). broadcast.jsonl: 동시 3+ division 활성 사이클 = C31-C32(3), C34-C41(3), C43(3), C47-C48(3), C53(3), C57(3), C60(3), C65(3). 최대 동시 활성: 3개. 4개 이상 동시 활성 사이클 = 0."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-099","location":"CONSTITUTION.md §1, METRICS.md","current":"Research Division: 전체 61 사이클 중 4 사이클만 활성 (6.6% 활용). C28-C84까지 56 사이클 연속 유휴. C85에서 첫 활성화 (RES-007). 7 research 문서 중 RES-001~005는 C58 이전에 완료 (planning phase), RES-006~007은 reactive 태스크.","expected":"CONSTITUTION §12 coordinator-session.md에 'research idle 3+ cycles → proactive mode' 규칙 존재하나, 실제로는 56 사이클 연속 유휴됨. 선행적 연구 (예: Axel runtime profiling, 메모리 사용 패턴, LLM cost optimization) 기회를 놓침.","evidence":"broadcast.jsonl C85: Research 첫 활성화 이후 연속 3 사이클 활성. coordinator-session.md idle detection 규칙과 실제 activation 이력 불일치. Research가 Sonnet 4.5 모델이므로 proactive 활성화의 비용 부담 낮음."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-100","location":"CONSTITUTION.md §1, BACKLOG.md Done","current":"Audit Division: 전체 61 사이클 중 6 사이클만 활성 (9.8% 활용). C59-C87까지 28 사이클 연속 유휴. 5개 감사 (AUDIT-001~005) 수행, 총 78 findings 생성. 현재 AUDIT-006은 운영 감사 (코드 감사 아님).","expected":"CONSTITUTION에 'audit every 10 cycles or milestone completion' 언급 없음 (coordinator-session.md에만 존재). 실제로는 Phase milestone 기반 반응적 활성화만 수행. C59-C87 (28 cycles) 동안 UI/UX Sprint 전체 + Post-Release Hardening이 진행되었으나 audit 미수행.","evidence":"broadcast.jsonl: AUDIT-004 at C54 (Phase D), AUDIT-005 at C58 (Phase E). UI/UX Sprint (C79-C85) 동안 audit 미수행. HARDEN-003~007 (C67-C70) 동안 audit 미수행. 코드 변경이 있었으나 감사 공백 존재."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-101","location":"cycle.sh lines 124-128, broadcast.jsonl","current":"cycle.sh에서 git rebase 실패 시 git reset --hard main 수행. Division의 미커밋 작업이 손실될 수 있음. 에러 복구 메커니즘이 '강제 리셋'뿐.","expected":"rebase 실패 원인 분석 없이 hard reset은 진행 중인 작업을 파괴. CONSTITUTION §6 escalation 규칙에 따르면 agent session failure는 'Log to ERRORS.md, retry next cycle'이어야 하나, cycle.sh는 ERRORS.md에 기록하지 않고 hard reset 수행.","evidence":"cycle.sh lines 124-128: 'git rebase main --quiet 2>&1 || { git rebase --abort 2>/dev/null || true; git reset --hard main 2>/dev/null || true; }'. ERRORS.md에 rebase failure 기록 없음. hard reset 발생 시 해당 cycle의 division 작업물 전량 손실."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-102","location":"cycle.sh, CONSTITUTION.md §12","current":"cycle.sh에 Division별 실행 timeout이 없음. run_division이 background process로 실행되지만 timeout 미설정. 느린 Division이 Phase 3 merge를 무한 대기시킬 수 있음.","expected":"각 Division 실행에 적정 timeout (예: 600s) 설정 필요. Claude API 호출이 무한 대기할 수 있으며, 이 경우 전체 cycle이 블록됨. CONSTITUTION §6에 escalation 규칙 있으나 cycle.sh에서 자동 감지 불가.","evidence":"cycle.sh line 224: 'run_division \"$div\" &' — timeout 없는 background process. Phase 3 merge 'wait \"${PIDS[@]}\"' 는 모든 division 완료까지 무한 대기. arch stall 패턴 (2.5 cycle avg) 감안 시, single-cycle 내 timeout은 약 10분이 적정."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-103","location":"cycle.sh lines 178-186, CONSTITUTION.md §12","current":"cycle.sh에서 broadcast.jsonl에 activation 메시지가 없으면 모든 Division을 기본 활성화: 'echo \"arch dev-core dev-infra dev-edge quality research devops audit\"'. 의도치 않은 전체 활성화 가능.","expected":"activation 메시지 부재 시 전체 Division 활성화는 비용 폭탄. CONSTITUTION §12: 'No Division may self-activate'. 기본값이 전체 활성화이면 §12 원칙과 모순. 빈 activation 시 0 division 활성이 안전한 기본값.","evidence":"cycle.sh lines 183-186: 'if [ -z \"$activation_line\" ]; then echo \"arch dev-core dev-infra dev-edge quality research devops audit\"; return; fi'. 이 경로가 실행되면 8개 Division × Opus/Sonnet API 호출 발생. coordinator 세션 실패 시 이 fallback 트리거됨."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-104","location":"CONSTITUTION.md §1, METRICS.md, broadcast.jsonl","current":"Quality Division: 11 tasks/19 active cycles = 0.58 tasks/cycle. Opus 4.6 모델 사용. 주요 업무는 코드 리뷰 (done 보고 검증, coverage 확인, §10 compliance). QA-012는 5 cycles stalled 후 cancelled (C34-C39). QA-013~022는 각각 1 cycle 완료.","expected":"Quality Division의 업무 패턴은 checklist-based verification (CONSTITUTION §3 quality gates). 이는 Sonnet 4.5로도 수행 가능한 구조화된 검증 작업. Opus 4.6 대비 Sonnet 4.5는 비용 1/5~1/10 수준이면서 structured review에 충분한 성능.","evidence":"CONSTITUTION §3 quality gates: 5개 체크리스트 항목. §10 test gate: 4개 조건 확인. Quality Division의 output은 issue 보고서 (structured findings). QA-012 stall 사례 (5 cycles → cancelled)는 Opus 4.6 사용에도 비효율 발생. Research(Sonnet)와 DevOps(Sonnet)의 task completion rate이 Quality(Opus)와 동등하거나 우수."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"MEDIUM","id":"AUD-105","location":"CONSTITUTION.md §1 Division table","current":"Dev-Core, Dev-Infra, Dev-Edge, UI/UX: 4개 Development Layer Division이 존재하나 동시 활성화된 적 없음. 최대 동시 dev division = 3 (C47-C48: dev-edge+dev-infra+devops, C56-C57: devops+dev-core+dev-edge). Development phase 순차 실행으로 인해 병렬성 미활용.","expected":"Development는 Core→Infra→Edge→UI/UX 순서 의존성이 있어 본질적으로 순차적. 그러나 4개 Division을 유지하면서 각각 전용 worktree, 전용 프롬프트, 전용 comms 파일을 관리하는 오버헤드 발생. Phase B (core만 활성, 10 cycles), Phase C (infra만 활성, 3 cycles), Phase D (edge만 활성, 10 cycles), UI Sprint (ui-ux만 활성, 4 cycles).","evidence":"broadcast.jsonl activation patterns: Phase B에서 dev-infra/dev-edge/ui-ux 전부 inactive. Phase C에서 dev-core/dev-edge/ui-ux 전부 inactive. Phase D에서 dev-core/dev-infra/ui-ux 전부 inactive. 실질적으로 한 번에 하나의 dev division만 활성. 통합 'dev' division이 순차적으로 각 package를 작업하는 것과 동일 효과."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"LOW","id":"AUD-106","location":"broadcast.jsonl, BACKLOG.md","current":"CTO override 8건 (SYNC-004 C46, PLAN-AMEND-001 C51, SYNC-005 C51, SYNC-006 C55, SYNC-007 C62, FIX-SCHEMA-001 C62, FIX-MIGRATION-002 C77, SYNC-004 partial C43). CTO가 arch의 PLAN_SYNC 및 plan-amendment 업무를 직접 수행.","expected":"CTO override는 응급 조치이나, 8건 발생은 arch Division의 역할과 역량에 구조적 문제 시사. PLAN_SYNC 업데이트가 반복적으로 stall되어 CTO가 대신 수행 → Coordinator의 업무 부하 증가 + 본래 역할(조정/감독) 시간 감소.","evidence":"BACKLOG.md Done: 'coord (CTO)' 완료 8건. METRICS.md: 'Architecture | Stalls: 5 (CTO override)'. CTO가 arch 업무까지 수행하면 CONSTITUTION §12 '오직 Coordinator만 activation 결정' 역할과 충돌 (조정자가 실행자를 겸임)."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"LOW","id":"AUD-107","location":"cycle.sh lines 49-54, CONSTITUTION.md §1","current":"모델 할당: research+devops → Sonnet 4.5, 나머지 8개 Division → Opus 4.6. Audit Division은 Opus 4.6 할당이나, 업무 패턴은 structured verification (cross-reference, consistency check, factual verification).","expected":"Audit의 업무는 plan↔code 교차 검증, 수치 일치 확인, 공식 스펙 대조 등 구조화된 검증. Research (Sonnet 4.5)도 유사한 수준의 분석 작업 수행. Audit를 Sonnet 4.5로 전환하면 비용 절감 가능. 단, security audit는 Opus 4.6 정밀도가 필요할 수 있음.","evidence":"AUDIT-001~005 findings 분석: 78건 중 대부분은 수치 비교 (768→3072), 문서 교차 참조 (ADR↔plan), 구조 패턴 검증 (TDD, file size). 이는 rule-based verification으로 Sonnet 4.5 수준으로 충분. Security audit (AUDIT-005 AUD-079~094)는 코드 심층 분석이 포함되어 Opus 필요 가능."}
{"ts":"0208C88","from":"audit","type":"finding","severity":"LOW","id":"AUD-108","location":"BACKLOG.md, ERRORS.md","current":"RES-007 (C87 완료)이 발견한 CLI 기억 상실 ROOT CAUSE에 대한 수정 태스크가 BACKLOG에 생성되지 않음. InboundHandler pushTurn/addMessage 미호출 + flush('*') 버그 + M2/M3 write path 누락.","expected":"RES-007이 3개 ROOT CAUSE를 명확히 식별했으나, C87 CTO broadcast에 FIX 태스크 생성 언급 없음. C88 CTO broadcast에도 없음. BACKLOG에 Queued/In Progress에 해당 FIX 미존재. 발견된 버그가 수정 파이프라인에 진입하지 못함.","evidence":"BACKLOG.md Queued: FIX-CYCLESH-001만 존재. In Progress: MIGRATE-PLAN-001, AUDIT-006만 존재. RES-007 findings에 대한 FIX-MEMORY-XXX 태스크 부재. broadcast.jsonl C87: '3 TASKS COMPLETED' 보고했으나 신규 FIX 태스크 미생성. C88: MIGRATE-PLAN-001 + AUDIT-006만 할당."}
{"ts":"0208C88","from":"audit","type":"done","task":"AUDIT-006","findings_critical":0,"findings_high":4,"findings_medium":7,"findings_low":3,"note":"AUDIT-006: 유휴 Division 활용 분석 + 에이전트 운영 효율화 방안 감사. 14 findings (AUD-095~108). === EXECUTIVE SUMMARY: 9 Division 조직은 C28-C88 (61 cycles) 동안 평균 1.84 division/cycle만 활성화. 전체 division-cycle 활용률 20.4%. 완전 유휴(all-idle) 8 cycles (13.1%). === HIGH (4): AUD-095 — 완전 유휴 사이클에서 CTO Opus 4.6 비용 낭비 (idle detection 부재). AUD-096 — Arch Division 체계적 병목 (5회 CTO override, avg 2.5 cycle/task). AUD-097 — dev-core 27 cycle 유휴 + RES-007 ROOT CAUSE 미수정 (InboundHandler 버그). AUD-098 — 10 Division 조직 과잉 설계 (평균 동시 활성 1.84, 최대 3). === MEDIUM (7): AUD-099 — Research 56 cycle 연속 유휴 (proactive mode 미작동). AUD-100 — Audit 28 cycle 유휴 (UI/UX Sprint+Hardening 감사 공백). AUD-101 — cycle.sh hard reset on rebase failure (작업 손실 위험). AUD-102 — Division 실행 timeout 부재. AUD-103 — activation fallback이 전체 활성화 (비용 폭탄 위험). AUD-104 — Quality Division Opus 4.6 사용 비효율 (structured verification에 Sonnet 충분). AUD-105 — 4개 dev division 동시 활성 불가 (순차 의존성으로 실질적 단일 dev 운영). === LOW (3): AUD-106 — CTO override 8건 (조정자가 실행자 겸임). AUD-107 — Audit Division Opus 4.6 할당 재검토 필요. AUD-108 — RES-007 ROOT CAUSE의 FIX 태스크 미생성 (파이프라인 누락). === 개선 제안: (1) cycle.sh idle detection: BACKLOG empty + 0 errors → CTO skip, (2) Division 통합 검토: 4 dev divisions → 1-2 dev divisions + phase-based scope, (3) 모델 다운그레이드: quality+audit → Sonnet 4.5 (security audit만 Opus), (4) arch stall 방지: 2 cycle limit 강제, (5) proactive research/audit 활성화 규칙 cycle.sh에 자동화, (6) Division timeout 추가 (600s), (7) rebase failure → ERRORS.md 기록 + retry (hard reset 금지). === 2차 저장: /home/northprot/.axel-ops/audit/ 디렉토리에 별도 보고서 작성."}
