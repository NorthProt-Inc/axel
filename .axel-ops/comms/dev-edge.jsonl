{"ts":"0208C47","from":"dev-edge","type":"done","task":"EDGE-001","out":"packages/core/src/types/channel.ts, packages/core/src/types/index.ts, packages/core/tests/types/channel.test.ts","note":"AxelChannel interface + 6 channel types defined. 7 exports: AxelChannel, ChannelCapabilities, InboundMessage, OutboundMessage, InboundHandler, MediaAttachment, PresenceStatus. Per plan L8 + ADR-009. Lifecycle (start/stop/healthCheck), reconnection (ERR-042), optional methods (streaming, presence, reactions, disconnect/reconnect, typing)."}
{"ts":"0208C47","from":"dev-edge","type":"test-result","pkg":"core","tests":354,"pass":354,"fail":0,"coverage":"N/A (type-only module)","note":"24 new channel tests + 330 existing. All pass. Biome clean on new files."}
{"ts":"0208C48","from":"dev-edge","type":"done","task":"EDGE-002","out":"packages/channels/src/cli/cli-channel.ts, packages/channels/tests/cli/cli-channel.test.ts","note":"CLI Channel AxelChannel impl. Node.js readline, fixed userId 'cli-user', streaming output, start/stop lifecycle, DI-friendly constructor (createReadline/write/onError). Empty line filtering, whitespace trimming, multiple handlers, error isolation. 133 lines src, 345 lines test. TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C48","from":"dev-edge","type":"test-result","pkg":"channels","tests":21,"pass":21,"fail":0,"coverage":"95.95% stmt, 100% branch, 90.9% func, 95.95% lines","note":"21 CLI channel tests. 529 total tests (43 files) pass. Biome+tsc clean."}
{"ts":"0208C50","from":"dev-edge","type":"done","task":"EDGE-003","out":"packages/channels/src/discord/discord-channel.ts, packages/channels/src/discord/index.ts, packages/channels/tests/discord/discord-channel.test.ts","note":"Discord Channel AxelChannel impl. discord.js Client with DI-friendly createClient. Bot/empty message filtering, channel caching, 2000 char splitting, streaming via message.edit() with throttle (1s interval), reconnection tracking (degraded health), onDisconnect/onReconnect handlers, addReaction stub. SendableChannel interface to avoid PartialGroupDMChannel TS issue. TDD: RED→GREEN→REFACTOR (cognitive complexity extracted into 3 helpers)."}
{"ts":"0208C50","from":"dev-edge","type":"test-result","pkg":"channels","tests":50,"pass":50,"fail":0,"coverage":"92.33% stmt, 94.59% branch, 90.32% func, 92.33% lines","note":"29 Discord + 21 CLI = 50 channel tests. 558 total tests (core+channels+infra) pass. Biome clean. Target 75% exceeded."}
{"ts":"0208C51","from":"dev-edge","type":"done","task":"BOOTSTRAP-001","out":"apps/axel/src/config.ts, apps/axel/src/container.ts, apps/axel/src/lifecycle.ts, apps/axel/src/main.ts, apps/axel/tests/config.test.ts, apps/axel/tests/container.test.ts, apps/axel/tests/lifecycle.test.ts","note":"Bootstrap + DI container. config.ts: Zod AxelConfigSchema with env mapping (230L). container.ts: ~20 injectable services — 6 memory layers, LLM providers, embedding, session router, context assembler, tool registry (276L). lifecycle.ts: aggregateHealth + startupHealthCheck + 4-phase gracefulShutdown per ADR-021 (137L). main.ts: bootstrap entry with SIGTERM/SIGINT handlers (60L). All files <400L. TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C51","from":"dev-edge","type":"test-result","pkg":"app","tests":33,"pass":33,"fail":0,"coverage":"86.95% stmt, 87.71% branch, 37.93% func, 86.95% lines","note":"33 new tests (13 config + 7 container + 13 lifecycle). main.ts 0% (entry point with signal handlers, not unit-testable). Excluding main.ts: config 100%, lifecycle 98.63%, container 85.82%. 591 total tests pass. Biome+tsc clean."}
{"ts":"0208C53","from":"dev-edge","type":"done","task":"EDGE-004","out":"packages/channels/src/telegram/telegram-channel.ts, packages/channels/src/telegram/index.ts, packages/channels/tests/telegram/telegram-channel.test.ts","note":"Telegram Channel AxelChannel impl. grammy Bot API, polling mode. 4096 char splitting, typing indicator via sendChatAction, streaming via editMessageText with 1.5s throttle. DI-friendly constructor (createBot/onError). Bot/empty message filtering. Module-level stream helpers (handleStreamOverflow, throttledStreamEdit, finalizeStream). TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C53","from":"dev-edge","type":"test-result","pkg":"channels","tests":73,"pass":73,"fail":0,"coverage":"94.16% stmt, 92.57% branch, 91.66% func, 94.16% lines","note":"23 Telegram + 29 Discord + 21 CLI = 73 channel tests. Telegram 97.66% stmt. 637 total tests pass. Biome+tsc clean. Target 75% exceeded."}
{"ts":"0208C53","from":"dev-edge","type":"done","task":"EDGE-005","out":"packages/gateway/src/server.ts, packages/gateway/src/index.ts, packages/gateway/tests/server.test.ts, packages/gateway/tests/websocket.test.ts","note":"Gateway HTTP+WS server. Node.js http + ws. Routes: GET /health (no auth), GET /health/detailed (auth), POST /api/v1/chat (auth+validation), POST /api/v1/chat/stream (SSE). WebSocket /ws with query param token auth. Security: timing-safe Bearer token comparison, CORS (configurable origins), error redaction (ENV-aware per ADR-011). Graceful shutdown (WS 1001, HTTP server close). Stub chat responses (full orchestrator integration deferred). TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C53","from":"dev-edge","type":"test-result","pkg":"gateway","tests":23,"pass":23,"fail":0,"coverage":"84.34% stmt, 88.46% branch, 94.73% func, 84.34% lines","note":"16 server + 7 WS = 23 gateway tests. 637 total tests (50 files) pass. Biome+tsc clean. Target 80% exceeded."}
{"ts":"0208C55","from":"dev-edge","type":"done","task":"FIX-GATEWAY-001","out":"packages/gateway/src/server.ts, packages/gateway/tests/server.test.ts, packages/gateway/tests/websocket.test.ts","note":"3 HIGH gateway security fixes (AUDIT-004). (1) AUD-065: WS auth replaced from query param to ADR-019 first-message pattern — client sends {type:'auth',token:...} as first frame, server validates within 5s timeout, closes with 4001 on failure, token no longer in URL. (2) AUD-066: In-memory sliding window rate limiting — per-IP request counting within 60s window, 429+Retry-After when exceeded, /health exempt. (3) AUD-067: 32KB request body size limit — streaming byte accumulator aborts on overflow, 413 Payload Too Large. Also: parseChatInput extracted (DRY). File: 391 lines (<400 §14). TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C55","from":"dev-edge","type":"test-result","pkg":"gateway","tests":32,"pass":32,"fail":0,"coverage":"87.01% stmt, 86.66% branch, 95.45% func, 87.01% lines","note":"22 server + 10 WS = 32 gateway tests (+9 new). 646 total tests (50 files) pass. Biome+tsc clean. Target 80% exceeded."}
{"ts":"0208C56","from":"dev-edge","type":"done","task":"FIX-MEDIUM-001","out":"packages/channels/src/utils/split-message.ts, packages/channels/src/telegram/telegram-channel.ts, packages/channels/src/discord/discord-channel.ts, apps/axel/src/lifecycle.ts, apps/axel/src/container.ts, packages/gateway/src/classify-error.ts, packages/gateway/src/server.ts, packages/gateway/src/index.ts","note":"8 MEDIUM fixes from QA-018/AUDIT-004. (1) lifecycle startTime: module-level const → function parameter, eliminates mutable module state. (2) HealthCheckTarget DRY: removed duplicate from container.ts, imports from lifecycle.ts. (3) Telegram userId guard: skip messages with undefined ctx.from (empty userId). (4) Container typed interfaces: replaced unsafe `as Parameters<...>[0]` casts with proper typed interfaces for anthropicClient/googleClient. (5) splitMessage DRY: extracted to channels/src/utils/split-message.ts, shared by Discord+Telegram. (6) classifyError ADR-011: structured error classification in gateway/src/classify-error.ts — TypeError/SyntaxError→400, generic→500, production message redaction. (7) Telegram onDisconnect/onReconnect: handler arrays + bot.catch notifies disconnect handlers. (8) CORS Vary: Origin header added in handleCors. REFACTOR: classifyError extracted to separate file (server.ts 414→388 lines, §14 compliant). TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C56","from":"dev-edge","type":"test-result","pkg":"channels,gateway,apps","tests":664,"pass":664,"fail":0,"coverage":"channels: cli 95.95%, discord 90.27%, telegram 93.18% | gateway: 88.4% | all targets met (channels 75%+, gateway 80%+)","note":"18 new tests: 5 splitMessage + 2 userId guard + 2 lifecycle startTime + 1 HealthCheckTarget DRY + 6 classifyError + 2 CORS Vary. 664 total tests (56 files) pass. Biome clean (117 pre-existing warnings, 0 new). TypeScript compiles. All files <400 lines."}
{"ts":"0208C58","from":"dev-edge","type":"done","task":"INTEG-003","out":"packages/gateway/src/server.ts, packages/gateway/src/types.ts, packages/gateway/src/http-utils.ts, packages/gateway/src/ws-handler.ts, packages/gateway/src/index.ts, packages/gateway/tests/integration.test.ts","note":"Gateway→Orchestrator integration via HandleMessage DI. POST /api/v1/chat calls handleMessage and returns content+sessionId+usage. POST /api/v1/chat/stream streams ReActEvents as SSE via onEvent callback. WS /ws chat messages route through handleMessage with streaming. All optional: returns 503 when handleMessage not configured. Extracted types.ts (60L), http-utils.ts (46L), ws-handler.ts (143L) from server.ts (292L). TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C58","from":"dev-edge","type":"done","task":"INTEG-004","out":"packages/gateway/src/server.ts, packages/gateway/src/route-handlers.ts, packages/gateway/src/types.ts, packages/gateway/src/index.ts, packages/gateway/tests/remaining-routes.test.ts","note":"Remaining gateway routes via DI injection. 6 new routes: POST /api/v1/memory/search (searchMemory), GET /api/v1/memory/stats (getMemoryStats), GET /api/v1/session (getSession), POST /api/v1/session/end (getSession+endSession), GET /api/v1/tools (listTools), POST /api/v1/tools/execute (executeTool). All optional deps return 503 when not configured. Input validation on all POST routes. Extracted route-handlers.ts (139L) factory. TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C58","from":"dev-edge","type":"test-result","pkg":"gateway","tests":78,"pass":78,"fail":0,"coverage":"94.53% stmt, 86.33% branch, 96.96% func, 94.53% lines","note":"78 gateway tests: 22 server + 12 integration + 26 remaining-routes + 8 classify-error + 10 WS + 2 cors-vary (was 32, now 78). 714 total tests pass. Biome+tsc clean. All files <400 lines. Target 80% far exceeded at 94.53%."}
{"ts":"0208C59","from":"dev-edge","type":"done","task":"INTEG-005","out":"apps/axel/src/bootstrap-channels.ts, apps/axel/src/main.ts, apps/axel/tests/bootstrap-channels.test.ts, packages/channels/src/cli/index.ts","note":"Channel bootstrap wiring. (1) createChannels: config-based channel creation — CLI (enabled by default), Discord (requires botToken), Telegram (requires botToken). (2) wireChannels: registers InboundHandler on each channel.onMessage, binding channel.send as SendCallback. Uses createInboundHandler from core/orchestrator for full pipeline (SessionRouter→ContextAssembler→PersonaEngine→reactLoop→send). (3) createHandleMessage: gateway HandleMessage adapter wrapping createInboundHandler, captures response via SendCallback and returns MessageResult. (4) main.ts: updated bootstrap to create channels, wire handlers, start channels, and register for graceful shutdown (was passing empty channels[]). (5) cli/index.ts: barrel export for CliChannel. Shared buildHandler() private helper eliminates dep assembly duplication. 135L src. TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C59","from":"dev-edge","type":"test-result","pkg":"apps/axel","tests":52,"pass":52,"fail":0,"coverage":"bootstrap-channels 98.85% stmt, 100% branch, 83.33% func | config 100% | lifecycle 98.63% | container 85.48% | main 0% (entry point)","note":"16 new bootstrap-channels tests + 36 existing = 52 apps/axel tests. 766 total tests (61 files) pass. Biome+tsc clean. All files <400 lines."}
{"ts":"0208C60","from":"dev-edge","type":"done","task":"INTEG-007","out":"apps/axel/tests/e2e-message-roundtrip.test.ts","note":"E2E integration test: CLI channel → InboundHandler → mock LLM → memory store → response. Full message roundtrip without real API keys. 8 test cases: (1) happy path — LLM response delivered via CLI, (2) sequential messages in same session, (3) LLM provider failure → error message, (4) session resolution failure → error message + LLM not called, (5) full context assembly pipeline — working memory + semantic search feed into LLM system message, (6) empty input filtering — CLI ignores blank lines, (7) single-chunk LLM response, (8) outbound markdown format verification. Uses real SessionRouter, ContextAssembler, reactLoop with mock deps (MockLlmProvider, MockSessionStore, MockContextDataProvider, MockTokenCounter). All CONSTITUTION §10 gates pass."}
{"ts":"0208C60","from":"dev-edge","type":"test-result","pkg":"apps/axel","tests":60,"pass":60,"fail":0,"coverage":"apps/axel/src 85.74% stmt | bootstrap-channels 98.85% | config 100% | lifecycle 98.63% | container 85.48%","note":"8 new E2E tests + 52 existing = 60 apps/axel tests. 774 total tests (62 files) pass. Biome+tsc clean. tools/migrate testcontainers dep failure pre-existing (devops scope)."}
{"ts":"0208C61","from":"dev-edge","type":"done","task":"FIX-AUDIT-E-001","out":"packages/gateway/src/ws-handler.ts, packages/gateway/src/server.ts, packages/gateway/src/types.ts, apps/axel/src/bootstrap-channels.ts, packages/gateway/tests/server.test.ts, packages/gateway/tests/websocket.test.ts, packages/gateway/tests/integration.test.ts","note":"3 HIGH AUDIT-005 gateway fixes. (1) AUD-079: WS message size limit — MAX_WS_MESSAGE_BYTES=65536, Buffer/Buffer[]/ArrayBuffer size check before processing, close 1009 on overflow. (2) AUD-080: Rate limit bucket memory leak — extracted evictStaleBuckets() for lazy cleanup of entries >2x window age, exposed getRateLimitBucketCount() for observability. (3) AUD-082: Missing timestamp — added timestamp: Date.now() to handleMessage calls in HTTP chat, SSE stream, and WS handler; updated HandleMessage type with readonly timestamp: number; bootstrap-channels.ts uses new Date(message.timestamp). TDD: RED→GREEN→REFACTOR, 3 commits."}
{"ts":"0208C61","from":"dev-edge","type":"test-result","pkg":"gateway","tests":82,"pass":82,"fail":0,"coverage":"server 94.79% | ws-handler 92.53% | http-utils 97.43% | route-handlers 97.5% | classify-error 100%","note":"82 gateway tests: 26 server + 12 integration + 26 remaining-routes + 8 classify-error + 10 WS (+4 new AUD-079/080/082). 782 total tests (62 files) pass. Biome+tsc clean. All files <400 lines. Target 80% far exceeded."}
{"ts":"0208C64","from":"dev-edge","type":"done","task":"FIX-AUDIT-E-004","out":"packages/gateway/src/http-utils.ts, packages/gateway/src/route-handlers.ts, packages/gateway/tests/security-headers.test.ts","note":"2 MEDIUM audit fixes. (1) AUD-086: Security headers X-Content-Type-Options: nosniff + X-Frame-Options: DENY added to sendJson() in http-utils.ts — applies to all HTTP responses (success, error, 401, 404, etc). (2) AUD-090: Unsafe cast in handleSessionEnd replaced with proper type narrowing — validates sessionId is a non-empty string before use, returns 500 on invalid session shape. TDD: RED→GREEN, 2 commits."}
{"ts":"0208C64","from":"dev-edge","type":"done","task":"INTEG-008","out":"packages/gateway/src/webhook-handlers.ts, packages/gateway/src/types.ts, packages/gateway/src/server.ts, packages/gateway/tests/webhook-handlers.test.ts","note":"Webhook routes per plan L9 / OpenAPI spec. (1) POST /webhooks/telegram: X-Telegram-Bot-Api-Secret-Token header verification (timing-safe), Telegram Update JSON parsing, text message routing to HandleMessage. Bot/empty message filtering. (2) POST /webhooks/discord: Ed25519 signature verification (X-Signature-Ed25519 + X-Signature-Timestamp), PING→PONG (type=1), APPLICATION_COMMAND (type=2) routed to HandleMessage with DEFERRED response (type=5). Both endpoints bypass Bearer auth (security: []). GatewayConfig extended with optional telegramWebhookSecret + discordPublicKey. webhook-handlers.ts 264L. TDD: RED→GREEN→REFACTOR (cognitive complexity split), 2 commits."}
{"ts":"0208C64","from":"dev-edge","type":"test-result","pkg":"gateway","tests":111,"pass":111,"fail":0,"coverage":"95.28% stmt, 82.69% branch, 97.82% func | webhook-handlers 96.8% | server 95.03% | http-utils 97.67% | route-handlers 97.58% | ws-handler 92.53% | classify-error 100%","note":"111 gateway tests: 26 server + 13 integration + 26 remaining-routes + 8 security-headers + 17 webhook-handlers + 6 classify-error + 13 WS + 2 cors-vary. 816 total tests pass (66 files). Biome+tsc clean. Target 80% far exceeded at 95.28%. Also formatted remaining-routes.test.ts (pre-existing biome issue)."}
{"ts":"0208C66","from":"dev-edge","type":"done","task":"FIX-HARDEN-002","out":"packages/core/src/orchestrator/inbound-handler.ts, apps/axel/src/bootstrap-channels.ts, packages/core/tests/orchestrator/inbound-handler.test.ts, apps/axel/tests/bootstrap-channels.test.ts","note":"AUD-093: Wire ToolRegistry tool definitions into InboundHandler. (1) Added optional toolDefinitions: readonly ToolDefinition[] to InboundHandlerDeps (defaults to []). (2) Replaced hardcoded tools:[] with tools:toolDefinitions in reactLoop call. (3) bootstrap-channels buildHandler() passes container.toolRegistry.listAll(). Enables Axel to use registered tools in conversation. Backward-compatible (defaults to empty). TDD: RED→GREEN, 2 commits."}
{"ts":"0208C66","from":"dev-edge","type":"test-result","pkg":"gateway,core,apps","tests":275,"pass":275,"fail":0,"coverage":"gateway 95.28% stmt | bootstrap-channels 98.86% stmt | apps/axel 85.76% stmt | channels unchanged (94%+)","note":"3 new tests (2 inbound-handler + 1 bootstrap-channels). 819 total tests pass (64/66 files — 2 pre-existing tools/migrate pg failures). Biome+tsc clean. All coverage targets met."}
{"ts":"0208C67","from":"dev-edge","type":"done","task":"HARDEN-003","out":"packages/gateway/src/webhook-handlers.ts, packages/gateway/tests/telegram-type-guard.test.ts","note":"QA-020-M1: Replaced nested Record<string,unknown> casting in extractTelegramMessage with TelegramUpdate interface + isTelegramUpdate type guard. 'in' narrowing eliminates 4-level casting chain. extractTelegramMessage now takes typed TelegramUpdate, not untyped Record. TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C67","from":"dev-edge","type":"done","task":"HARDEN-004","out":"packages/gateway/src/webhook-handlers.ts, packages/gateway/tests/discord-type-guard.test.ts","note":"QA-020-M2: Replaced nested Record<string,unknown> casting in extractDiscordInteraction with DiscordInteraction interface + isDiscordInteraction type guard. Extracted isValidDiscordData + isValidDiscordMember helpers to reduce cognitive complexity from 25 to under Biome limits. TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C67","from":"dev-edge","type":"done","task":"HARDEN-005","out":"packages/gateway/src/server.ts, packages/gateway/src/types.ts, packages/gateway/tests/proxy-rate-limit.test.ts","note":"AUD-087: Added optional trustedProxies: readonly string[] to GatewayConfig. When set, getClientIp parses X-Forwarded-For walking right-to-left, skipping trusted IPs. Falls back to socket IP when unconfigured or XFF absent. Multi-hop proxy chains tested. TDD: RED→GREEN→REFACTOR."}
{"ts":"0208C67","from":"dev-edge","type":"test-result","pkg":"gateway","tests":148,"pass":148,"fail":0,"coverage":"95.47% stmt, 87.77% branch, 97.95% func","note":"148 gateway tests (prev 111 + 37 new): 16 telegram-type-guard + 16 discord-type-guard + 5 proxy-rate-limit. 820 total tests pass (69 files, 5 pre-existing tools/migrate failures excluded). Biome 0 errors, tsc clean. Coverage target 80% far exceeded at 95.47%."}
{"ts":"0208C69","from":"dev-edge","type":"done","task":"HARDEN-006","out":"packages/gateway/src/webhook-handlers.ts, packages/gateway/src/types.ts, packages/gateway/tests/discord-deferred.test.ts","note":"QA-020-M3: Refactored handleDiscordCommand to fire-and-forget pattern. DEFERRED (type=5) sent immediately. handleMessage runs asynchronously with follow-up via DiscordFollowUp callback (DI). Added discordApplicationId to GatewayConfig, token/application_id to DiscordInteraction. Error path sends user-friendly Korean message. 6 new tests. TDD RED→GREEN."}
{"ts":"0208C69","from":"dev-edge","type":"done","task":"HARDEN-007","out":"packages/gateway/src/server.ts, packages/gateway/tests/sse-headers-startedat.test.ts","note":"QA-020-L3 + AUD-094: (1) Added X-Content-Type-Options: nosniff + X-Frame-Options: DENY to SSE writeHead in handleChatStream. (2) Moved startedAt from createGatewayServer scope to start() listen callback for accurate uptime measurement. 4 new tests. TDD RED→GREEN."}
{"ts":"0208C69","from":"dev-edge","type":"test-result","pkg":"gateway","tests":158,"pass":158,"fail":0,"coverage":"95.65% stmt, 88.07% branch, 98% func | webhook-handlers 97.47% | server 95.31% | http-utils 97.67% | route-handlers 97.58% | ws-handler 92.53% | classify-error 100%","note":"158 gateway tests (prev 148 + 10 new: 6 discord-deferred + 4 sse-headers-startedat). 830 total tests pass (69+2 files, 5 pre-existing tools/migrate failures excluded). Biome 0 errors, tsc clean. Also fixed pre-existing biome warnings in telegram/discord-type-guard tests. Coverage target 80% far exceeded at 95.65%."}
{"ts":"0208C91","from":"dev-edge","type":"done","task":"FIX-MEMORY-002","out":"apps/axel/src/lifecycle.ts, apps/axel/src/bootstrap-channels.ts, apps/axel/src/main.ts, apps/axel/tests/lifecycle.test.ts, apps/axel/tests/bootstrap-channels.test.ts","note":"RES-007 ROOT CAUSE #2 resolved. (1) gracefulShutdown: flush('*') → per-user flush via getActiveUserIds(). ActiveUserTracker tracks userIds from incoming messages. Per-user error isolation — one flush failure doesn't block others. (2) bootstrap-channels buildHandler: workingMemory + episodicMemory now passed to createInboundHandler (completes FIX-MEMORY-001 wiring). TDD RED→GREEN→REFACTOR. 5 new tests (+4 lifecycle, +1 bootstrap)."}
{"ts":"0208C91","from":"dev-edge","type":"test-result","pkg":"apps/axel","tests":66,"pass":66,"fail":0,"coverage":"lifecycle 98.68% stmt, bootstrap-channels 92.07% stmt","note":"990 total tests (84 files, 1 skip), 0 FAIL. tsc clean, Biome 0 errors."}
